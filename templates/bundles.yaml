# ZZCOLLAB Profile Bundles
# Defines reusable bundles for system libraries and R packages
# Used by --libs and --pkgs flags

#=============================================================================
# SYSTEM LIBRARY BUNDLES (--libs)
#=============================================================================
# These are sets of system dependencies installed via apt-get or apk

library_bundles:
  none:
    description: "No additional system libraries"
    deps: []
    package_manager: "apt-get"
    compatible_bases: ["rocker/r-ver"]
    warning: "Most R packages will fail without system dependencies"

  minimal:
    description: "Essential development libraries"
    deps:
      - git
      - curl
      - wget
    package_manager: "apt-get"
    compatible_bases: ["rocker/*", "bioconductor/*"]
    note: "Dev headers (libcurl4-openssl-dev, libssl-dev, libxml2-dev) in common section"

  geospatial:
    description: "Geospatial analysis libraries (GDAL, PROJ, GEOS)"
    deps:
      - gdal-bin
      - proj-bin
      - libgeos-dev
      - libproj-dev
      - libgdal-dev
      - libudunits2-dev
      - netcdf-bin
    package_manager: "apt-get"
    compatible_bases: ["rocker/geospatial", "rocker/r-ver", "rocker/rstudio"]
    required_for_pkgs: ["geospatial"]
    note: "libxml2-dev in common section"

  bioinfo:
    description: "Bioinformatics libraries for genomics packages"
    deps:
      - zlib1g-dev
      - libbz2-dev
      - liblzma-dev
    package_manager: "apt-get"
    compatible_bases: ["bioconductor/*", "rocker/*"]
    required_for_pkgs: ["bioinfo"]
    note: "libxml2-dev, libcurl4-openssl-dev, libssl-dev in common section"

  modeling:
    description: "Statistical modeling and ML libraries"
    deps:
      - libgsl-dev
    package_manager: "apt-get"
    compatible_bases: ["rocker/*"]
    note: "libxml2-dev, libcurl4-openssl-dev, libssl-dev, build-essential in common; libblas-dev, liblapack-dev, gfortran in rocker/r-ver"

  publishing:
    description: "Publishing and LaTeX libraries"
    deps:
      - pandoc
      - texlive-full
      - libv8-dev
    package_manager: "apt-get"
    compatible_bases: ["rocker/verse", "rocker/*"]
    note: "libxml2-dev, libcurl4-openssl-dev, libssl-dev in common section"

  terminals:
    description: "GUI terminals and fonts (lightweight GUI)"
    deps:
      - xfce4-terminal
      - terminator
      - xterm
      - fonts-jetbrains-mono
      - fonts-firacode
      - fonts-hack
      - fonts-dejavu
      - fonts-liberation
    package_manager: "apt-get"
    compatible_bases: ["rocker/*"]
    note: "Requires X11 forwarding (XQuartz on macOS). Includes Nerd Fonts."

  gui:
    description: "X11 GUI support for graphical applications"
    deps:
      - xorg
      - x11-apps
      - xauth
      - libx11-dev
      - libxt-dev
      - libcairo2-dev
      - libgl1-mesa-dev
      - libglu1-mesa-dev
      - fonts-dejavu
      - fonts-liberation
      - firefox
      - gedit
    package_manager: "apt-get"
    compatible_bases: ["rocker/*"]
    note: "Requires X11 forwarding from host (XQuartz on macOS, X11 on Linux)"

  alpine:
    description: "Alpine Linux libraries (apk package manager)"
    deps:
      - git
      - make
      - gcc
      - "g++"
      - musl-dev
      - linux-headers
      - curl-dev
      - openssl-dev
      - libxml2-dev
    package_manager: "apk"
    compatible_bases: ["velaco/alpine-r"]
    incompatible_bases: ["rocker/*", "bioconductor/*"]

#=============================================================================
# R PACKAGE BUNDLES (--pkgs)
#=============================================================================
# These are sets of R packages installed via install.packages() or BiocManager

package_bundles:
  minimal:
    description: "Minimal essential packages for development"
    packages:
      - renv
      - devtools
      - usethis
      - testthat
      - roxygen2
    requires_libs: ["minimal", "alpine"]

  tidyverse:
    description: "Tidyverse ecosystem for data analysis"
    packages:
      - renv
      - devtools
      - tidyverse
      - here
      - janitor
      - scales
      - patchwork
    requires_libs: ["minimal", "alpine"]

  modeling:
    description: "Machine learning and statistical modeling"
    packages:
      - renv
      - devtools
      - tidyverse
      - tidymodels
      - xgboost
      - randomForest
      - glmnet
      - caret
    requires_libs: ["minimal", "modeling"]

  bioinfo:
    description: "Bioinformatics and genomics packages"
    packages:
      - renv
      - devtools
      - BiocManager
      - DESeq2
      - edgeR
      - limma
      - GenomicRanges
      - Biostrings
    requires_libs: ["bioinfo"]
    bioconductor: true

  geospatial:
    description: "Geospatial analysis and mapping"
    packages:
      - renv
      - devtools
      - sf
      - terra
      - leaflet
      - mapview
      - tmap
    requires_libs: ["geospatial"]

  publishing:
    description: "Document publishing and visualization"
    packages:
      - renv
      - devtools
      - quarto
      - bookdown
      - blogdown
      - distill
      - flexdashboard
      - DT
    requires_libs: ["minimal", "publishing"]

  shiny:
    description: "Shiny web applications"
    packages:
      - renv
      - devtools
      - shiny
      - shinydashboard
      - shinyWidgets
      - DT
      - plotly
      - bslib
    requires_libs: ["minimal"]

  gui:
    description: "GUI applications and interactive graphics"
    packages:
      - renv
      - devtools
      - tidyverse
      - rgl
      - plotly
      - shiny
      - Cairo
      - svglite
    requires_libs: ["gui"]

#=============================================================================
# COMPLETE PROFILES (--profile-name)
#=============================================================================
# Predefined combinations of base-image + libs + pkgs

profiles:
  minimal:
    description: "Minimal development environment (command-line only)"
    base_image: "rocker/r-ver"
    libs: minimal
    pkgs: minimal
    size: "~650MB"
    note: "No GUI terminals, no fonts. Pure command-line: vim, zsh, git."

  minimal-gui:
    description: "Minimal with GUI terminals and fonts"
    base_image: "rocker/r-ver"
    libs: terminals
    pkgs: minimal
    size: "~720MB"
    note: "Adds GUI terminals (xfce4-terminal, terminator, xterm) + Nerd Fonts"

  rstudio:
    description: "RStudio Server development environment"
    base_image: "rocker/rstudio"
    libs: minimal
    pkgs: minimal
    size: "~980MB"

  analysis:
    description: "Data analysis with tidyverse"
    base_image: "rocker/tidyverse"
    libs: minimal
    pkgs: tidyverse
    size: "~1.18GB"

  modeling:
    description: "Machine learning environment"
    base_image: "rocker/r-ver"
    libs: modeling
    pkgs: modeling
    size: "~1.48GB"

  bioinformatics:
    description: "Bioinformatics with Bioconductor"
    base_image: "bioconductor/bioconductor_docker"
    libs: bioinfo
    pkgs: bioinfo
    size: "~1.98GB"

  geospatial:
    description: "Geospatial analysis environment"
    base_image: "rocker/geospatial"
    libs: geospatial
    pkgs: geospatial
    size: "~2.48GB"

  publishing:
    description: "Document publishing with LaTeX"
    base_image: "rocker/verse"
    libs: publishing
    pkgs: publishing
    size: "~3GB"

  alpine_minimal:
    description: "Ultra-lightweight Alpine Linux"
    base_image: "velaco/alpine-r"
    libs: alpine
    pkgs: minimal
    size: "~200MB"

  alpine_analysis:
    description: "Lightweight data analysis"
    base_image: "velaco/alpine-r"
    libs: alpine
    pkgs: tidyverse
    size: "~400MB"

  gui:
    description: "GUI applications with X11 forwarding"
    base_image: "rocker/rstudio"
    libs: gui
    pkgs: gui
    size: "~2.2GB"
    note: "Requires XQuartz (macOS) or X11 (Linux) for display forwarding"
    usage: "make docker-zsh-gui  # Launch with GUI support"

  gui_minimal:
    description: "Minimal R environment with GUI/X11 support"
    base_image: "rocker/r-ver"
    libs: gui
    pkgs: minimal
    size: "~1.5GB"
    note: "GUI apps (kitty, firefox) with minimal R packages"

  gui_analysis:
    description: "Data analysis with tidyverse and GUI support"
    base_image: "rocker/tidyverse"
    libs: gui
    pkgs: tidyverse
    size: "~2.5GB"
    note: "Full analysis stack with GUI applications"

  gui_rstudio:
    description: "RStudio Server with GUI support for desktop apps"
    base_image: "rocker/rstudio"
    libs: gui
    pkgs: minimal
    size: "~2GB"
    note: "RStudio Server + GUI apps (kitty, firefox) via X11"

#=============================================================================
# COMPATIBILITY RULES
#=============================================================================
# Used for validation

compatibility_rules:
  alpine_requires_alpine_libs:
    condition: "base_image contains 'alpine'"
    requires_libs: ["alpine"]
    error: "Alpine base images require --libs alpine (different package manager)"

  bioconductor_requires_bioinfo_libs:
    condition: "base_image contains 'bioconductor'"
    requires_libs: ["bioinfo"]
    error: "Bioconductor images require --libs bioinfo (specific dependencies)"

  geospatial_pkgs_require_libs:
    condition: "pkgs == 'geospatial'"
    requires_libs: ["geospatial"]
    error: "Geospatial packages require --libs geospatial (GDAL/PROJ libraries)"

  bioinfo_pkgs_require_libs:
    condition: "pkgs == 'bioinfo'"
    requires_libs: ["bioinfo"]
    error: "Bioinformatics packages require --libs bioinfo (genomics dependencies)"
