---
title: "Solo Manuscript Workflow with ZZCOLLAB"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Solo Manuscript Workflow with ZZCOLLAB}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Overview

This vignette demonstrates how solo researchers can use ZZCOLLAB's manuscript paradigm (`-P manuscript`) to create a reproducible framework for writing scholarly papers. The manuscript paradigm provides a complete research compendium structure that integrates analysis, documentation, and publication workflows.

## What is the Manuscript Paradigm?

The manuscript paradigm is designed for academic writing projects where you need to:

- Develop analysis functions alongside your paper
- Ensure complete reproducibility of results
- Manage citations and references
- Create publication-ready figures and tables
- Prepare supplementary materials
- Submit to journals with confidence in reproducibility

## Key Features

- **R package structure** for organized, documented functions
- **Integrated testing** with testthat framework
- **Academic templates** for papers and supplementary materials
- **Citation management** with bibliography integration
- **Reproducible workflows** from data to publication
- **Version control ready** for collaborative writing

# Getting Started

## 1. Initial Setup

First, configure your ZZCOLLAB defaults for manuscript work:

```bash
# Set manuscript as your default paradigm
zzcollab --config set paradigm manuscript
zzcollab --config set team-name "myresearch"
zzcollab --config set build-mode standard
```

## 2. Create a Manuscript Project

Create a new manuscript project:

```bash
# Create a new manuscript project
zzcollab -i -p penguin-morphology -P manuscript

# The -P manuscript flag creates the manuscript paradigm structure
```

This creates a complete research compendium with:

```
penguin-morphology/
├── R/                          # Analysis functions (package functions)
├── tests/testthat/             # Function tests
├── man/                        # Auto-generated documentation
├── manuscript/                 # Paper files
│   ├── journal_templates/      # Journal-specific formatting
│   ├── paper.Rmd
│   ├── supplementary.Rmd
│   └── references.bib
├── analysis/reproduce/         # Complete reproduction scripts
│   ├── 01_data_preparation.R
│   ├── 02_statistical_analysis.R
│   ├── 03_figures_tables.R
│   └── 04_manuscript_render.R
├── data/
│   ├── raw_data/               # Original, untouched data
│   └── derived_data/           # Processed, analysis-ready data
├── submission/                 # Journal submission files
│   ├── figures/
│   ├── tables/
│   ├── supplementary/
│   └── manuscript_versions/
├── vignettes/                  # Extended documentation
├── inst/examples/              # Example analyses and datasets
├── DESCRIPTION                 # Package metadata with authors
└── NAMESPACE                   # Function exports (auto-generated)
```

## 3. Enter the Development Environment

```bash
# Enter the reproducible container environment
cd penguin-morphology
make docker-zsh
```

# Manuscript Development Workflow

## Step 1: Develop Analysis Functions

The install program creates `R/analysis_functions.R` with template functions that you can customize for your research. Start by adapting these templates:

```r
# R/analysis_functions.R (created by zzcollab install)
# The install program creates template functions that you can customize:

#' Prepare data for analysis
#' @param data Raw dataset
#' @return Cleaned and processed data
prepare_penguin_data <- function(data = palmerpenguins::penguins) {
  # Customize the clean_raw_data() template function
  data %>%
    filter(!is.na(bill_length_mm), !is.na(body_mass_g)) %>%
    mutate(species = as.factor(species))
}

#' Analyze morphological patterns
#' @param data Processed dataset
#' @return Statistical model results
analyze_morphology <- function(data) {
  # Customize the fit_primary_model() template function
  model <- lm(bill_length_mm ~ species + body_mass_g, data = data)
  broom::tidy(model)
}

# Note: The install program also creates these template functions:
# - check_analysis_currency() - Check if results are up to date
# - clean_raw_data() - Generic data cleaning template
# - validate_data_quality() - Data quality validation
# - compute_descriptive_statistics() - Descriptive statistics
# - fit_primary_model() - Generic statistical modeling template
```

## Step 2: Write Tests

Create comprehensive tests for your functions:

```r
# tests/testthat/test-analysis-functions.R
# The install program creates this test file structure
test_that("prepare_penguin_data works correctly", {
  result <- prepare_penguin_data()
  expect_s3_class(result, "data.frame")
  expect_true(all(!is.na(result$bill_length_mm)))
})

test_that("analyze_morphology produces valid results", {
  data <- prepare_penguin_data()
  result <- analyze_morphology(data)
  expect_s3_class(result, "data.frame")
  expect_true("estimate" %in% names(result))
})
```

## Step 3: Generate Documentation

Document your functions with roxygen2:

```r
#' Prepare penguin data for analysis
#'
#' @param data Raw penguin dataset
#' @return Cleaned data frame
#' @export
#' @examples
#' clean_data <- prepare_penguin_data()
prepare_penguin_data <- function(data = palmerpenguins::penguins) {
  # Function implementation
}
```

Generate documentation:

```bash
# Generate documentation
make document
```

## Step 4: Write Your Manuscript

The manuscript paradigm includes pre-configured templates:

### Main Paper (`manuscript/paper.Rmd`)

```yaml
---
title: "Species Differences in Penguin Morphology"
author: "Your Name"
output:
  pdf_document:
    keep_tex: true
bibliography: references.bib
---
```

```r
# Setup chunk loads your package functions
library(penguinmorphology)  # Your project package name
library(dplyr)
library(ggplot2)

# Load development version of your functions
devtools::load_all()

# Use your analysis functions
data <- prepare_penguin_data()
results <- analyze_morphology(data)
```

### Supplementary Materials (`manuscript/supplementary.Rmd`)

Pre-configured template for supplementary analyses, additional figures, and detailed methods.

### Bibliography (`manuscript/references.bib`)

Integrated citation management:

```bibtex
@article{gorman2014,
  title={Ecological sexual dimorphism in penguins},
  author={Gorman, Kristen B and Williams, Tony D},
  journal={PLoS One},
  year={2014}
}
```

## Step 5: Create Reproducible Analysis Scripts

The `analysis/reproduce/` directory contains numbered scripts that reproduce your entire analysis:

```r
# analysis/reproduce/01_data_preparation.R
# This script is created by the install program
library(here)
devtools::load_all()  # Load your package functions

data <- prepare_penguin_data()
saveRDS(data, here("data", "derived_data", "processed_penguins.rds"))

# analysis/reproduce/02_statistical_analysis.R
# This script is created by the install program
data <- readRDS(here("data", "derived_data", "processed_penguins.rds"))
results <- analyze_morphology(data)
saveRDS(results, here("analysis", "results", "morphology_analysis.rds"))

# analysis/reproduce/03_figures_tables.R
# This script is created by the install program
# Generate all manuscript figures and tables

# analysis/reproduce/04_manuscript_render.R
# This script is created by the install program
# Render final manuscript files
```

# Reproducibility in Practice: Docker + renv + Configuration

## Daily Workflow with Reproducibility Tools

### Starting Your Manuscript Session

```bash
# Configuration automatically loads your preferences
cd penguin-morphology

# Enter identical containerized environment every time
make docker-zsh

# Inside container: renv ensures identical package versions
R
> renv::status()  # Verify all packages consistent
> library(tidyverse)  # Loads exact version from renv.lock
```

### Installing New Packages

When you need additional packages for your analysis:

```r
# Inside the container
install.packages("brms")  # Install new package
renv::snapshot()          # Lock the new version

# This updates renv.lock with exact package versions
# Now all collaborators get the same brms version
```

### Configuration for Different Manuscript Types

Set up specialized configurations for different types of papers:

```bash
# For Bayesian analysis papers
zzcollab --config set build-mode bayesian
# Custom build mode includes: brms, rstanarm, bayesplot, posterior

# For meta-analysis papers
zzcollab --config set build-mode meta-analysis
# Custom build mode includes: metafor, meta, dmetar, forestplot

# Projects inherit these specialized configurations automatically
```

### Reproducibility Validation

Before submission, validate complete reproducibility:

```bash
# Exit container and clean everything
exit
docker system prune -f  # Remove all cached images

# Start completely fresh
make docker-zsh  # Rebuilds environment from scratch
source("analysis/reproduce/run_all.R")  # Should work identically

# If this succeeds, your manuscript is truly reproducible
```

## Configuration Examples for Manuscript Projects

### Basic Manuscript Configuration

```yaml
# ~/.zzcollab/config.yaml
defaults:
  paradigm: manuscript
  team_name: "myresearch"
  build_mode: standard
  dotfiles_dir: "~/dotfiles"

build_modes:
  standard:
    description: "Standard manuscript packages"
    docker_packages: [renv, tidyverse, rmarkdown, knitr]
    renv_packages: [renv, tidyverse, rmarkdown, knitr, broom, gt, gtsummary]
```

### Advanced Analysis Configuration

```yaml
# For papers requiring advanced statistical methods
build_modes:
  advanced_stats:
    description: "Advanced statistical analysis"
    docker_packages: [renv, tidyverse, rstan]
    renv_packages: [
      renv, tidyverse, brms, rstanarm,
      bayesplot, posterior, tidybayes,
      marginaleffects, parameters, performance
    ]
```

### Collaborative Manuscript Configuration

```yaml
# Project-specific zzcollab.yaml for team manuscripts
team:
  name: "morphology-lab"
  project: "penguin-bill-study"

collaboration:
  github:
    auto_create_repo: true
    default_visibility: "private"

build:
  use_config_profiles: true

profiles:
  manuscript:
    enabled: true
    base_image: "rocker/verse:latest"
    packages: [renv, tidyverse, brms, gt, gtsummary]
```

# Development Commands

## Package Development

```bash
# Run tests (in consistent Docker environment)
make docker-test

# Check package (in clean environment)
make docker-check

# Build package
make build

# Generate documentation
make document
```

## Manuscript Rendering

```bash
# Render main paper (with locked package versions)
make docker-zsh
Rscript -e "rmarkdown::render('manuscript/paper.Rmd')"

# Render supplementary materials
Rscript -e "rmarkdown::render('manuscript/supplementary.Rmd')"

# Render manuscript files using Docker
make docker-zsh
Rscript -e "rmarkdown::render('manuscript/paper.Rmd')"
Rscript -e "rmarkdown::render('manuscript/supplementary.Rmd')"
```

## Reproducibility Validation

```bash
# Validate package consistency
make docker-zsh
Rscript -e "renv::status()"  # Should show no issues

# Run full reproduction pipeline (in clean container)
make docker-clean  # Start with fresh container
Rscript analysis/reproduce/01_data_preparation.R
Rscript analysis/reproduce/02_statistical_analysis.R
Rscript analysis/reproduce/03_create_figures.R
Rscript analysis/reproduce/04_create_tables.R

# Check for any differences in outputs
git status  # Should show no changes if truly reproducible
```

## Dependency Management

```bash
# Check renv status
Rscript -e "renv::status()"

# Update package snapshot
Rscript -e "renv::snapshot()"

# Restore exact package environment (for collaborators)
Rscript -e "renv::restore()"

# Validate dependency consistency before submission
Rscript check_renv_for_commit.R --build-mode standard --fail-on-issues
```

# Publishing Workflow

## 1. Prepare Submission Files

The manuscript paradigm includes a `submission/` directory for journal-ready files:

```bash
# Copy final files to submission directory
cp manuscript/paper.pdf submission/
cp manuscript/supplementary.pdf submission/
cp -r figures/ submission/
cp -r tables/ submission/
```

## 2. Archive Analysis

Create a permanent archive of your analysis:

```bash
# Create analysis archive
tar -czf submission/analysis_archive.tar.gz R/ tests/ analysis/ data/
```

## 3. Version Control

Commit your complete manuscript:

```bash
git add .
git commit -m "Complete manuscript ready for submission"
git tag v1.0-submission
```

# Benefits of the Manuscript Paradigm

## Docker-Based Reproducibility

ZZCOLLAB's manuscript paradigm leverages Docker containers to ensure perfect reproducibility:

- **Identical environments**: Your manuscript renders identically on any system (Mac, Windows, Linux)
- **Version locked dependencies**: R version, system libraries, and package versions are frozen
- **No "works on my machine" problems**: Reviewers and collaborators get exactly your computing environment
- **Long-term stability**: Your analysis will work years later, even as R and packages evolve
- **Journal compliance**: Meets increasing reproducibility requirements from publishers

```bash
# Your manuscript environment is completely isolated
make docker-zsh  # Enters containerized R environment
# All package versions, R version, system dependencies identical across users
```

## renv Package Management

The manuscript paradigm integrates renv for robust dependency management:

- **Locked package versions**: `renv.lock` captures exact package versions used
- **Reproducible installs**: Collaborators get identical package versions automatically
- **Dependency isolation**: Project packages don't interfere with system R libraries
- **Restoration guarantee**: Perfect package environment restoration months or years later

```r
# renv automatically manages your project dependencies
renv::status()     # Check package consistency
renv::snapshot()   # Lock current package versions
renv::restore()    # Restore exact package environment
```

## Configuration System Benefits

ZZCOLLAB's configuration system eliminates repetitive setup and ensures consistency:

### Personal Configuration (`~/.zzcollab/config.yaml`)

Set your defaults once, use everywhere:

```bash
# Configure your research preferences once
zzcollab --config set paradigm manuscript
zzcollab --config set team-name "myresearch"
zzcollab --config set build-mode standard
zzcollab --config set dotfiles-dir "~/dotfiles"

# Now all new projects use your preferences automatically
zzcollab -i -p new-paper  # Uses manuscript paradigm automatically
```

### Project-Specific Configuration

Each manuscript project can override defaults for specific needs:

```yaml
# Project's zzcollab.yaml
defaults:
  paradigm: manuscript
  build_mode: comprehensive  # More packages for complex analysis

# Custom package sets for this specific paper
build_modes:
  comprehensive:
    renv_packages: [tidyverse, brms, rstanarm, bayesplot, ggdist]
```

### Benefits for Manuscript Writing

- **Consistent environments**: All your papers use the same base setup
- **Easy collaboration**: Team members get identical configurations
- **Reproducible workflows**: Configuration is version-controlled with your paper
- **Scalable research**: Templates and settings work across multiple manuscripts

## Complete Reproducibility Stack

The combination of Docker + renv + configuration creates unprecedented reproducibility:

### System-Level Reproducibility (Docker)
- Operating system, R version, system libraries
- LaTeX installation for PDF generation
- Development tools and utilities

### Package-Level Reproducibility (renv)
- Exact R package versions
- Package source locations
- Dependency resolution

### Workflow-Level Reproducibility (Configuration)
- Project structure and templates
- Build processes and validation
- Team collaboration settings

## Publication and Archival Benefits

This reproducibility stack provides significant advantages for scholarly publishing:

### For Authors
- **Confidence in results**: Identical environment guarantees consistent results
- **Easy revisions**: Reproduce analysis exactly during peer review
- **Collaboration support**: Co-authors get identical computational environment
- **Future-proofing**: Analysis remains runnable years later

### For Journals
- **Meets reproducibility standards**: Satisfies computational reproducibility requirements
- **Reviewer access**: Reviewers can run your analysis in identical environment
- **Editorial efficiency**: Reduces time spent on reproducibility issues
- **Archive quality**: Complete computational environment preserved

### For the Scientific Community
- **True reproducibility**: Others can exactly replicate your computational environment
- **Building on research**: Future work can start from your exact setup
- **Teaching resource**: Students learn on the same environment as published research
- **Method validation**: Computational methods can be verified independently

## Reproducibility

- **Functions in R package format**: Documented, tested, and version-controlled
- **Complete reproduction scripts**: Step-by-step analysis recreation
- **Containerized environment**: Identical computing environment for all users
- **Dependency management**: Exact package versions locked and restorable

## Collaboration Ready

- **Standard R package structure**: Familiar to R developers
- **Comprehensive documentation**: Functions documented with roxygen2
- **Testing framework**: Prevents regressions during collaboration
- **Configuration sharing**: Team settings version-controlled and synchronized

## Journal Submission

- **Professional structure**: Research compendium format accepted by journals
- **Complete documentation**: Meets reproducibility requirements
- **Archival ready**: All code, data, and outputs organized for long-term storage
- **Computational reproducibility**: Full environment specification included

## Long-term Maintenance

- **Package format**: Easy to install and use years later
- **Version controlled**: Complete history of changes
- **Self-contained**: All dependencies documented and managed
- **Environment preservation**: Complete computational environment archived

# Example: Complete Penguin Morphology Study

This example demonstrates the full workflow from project creation to manuscript submission:

## Project Setup

```bash
zzcollab -i -p penguin-morphology -P manuscript
cd penguin-morphology
make docker-zsh
```

## Analysis Development

```r
# Develop functions in R/
# Write tests in tests/testthat/
# Document with roxygen2
# Validate with make test && make check
```

## Manuscript Writing

```r
# Write paper in manuscript/paper.Rmd
# Create supplementary materials
# Manage citations in references.bib
# Generate figures and tables
```

## Submission Preparation

```bash
# Render final manuscripts
make manuscript

# Run complete reproduction
source("analysis/reproduce/run_all.R")

# Prepare submission files manually
cp manuscript/paper.pdf submission/
cp manuscript/supplementary.pdf submission/
tar -czf submission/analysis_archive.tar.gz R/ tests/ analysis/ data/
```

The manuscript paradigm provides a complete framework for scholarly writing that ensures reproducibility, facilitates collaboration, and meets journal requirements for computational research.