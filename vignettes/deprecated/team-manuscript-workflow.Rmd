---
title: "Team Manuscript Workflow with ZZCOLLAB"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Team Manuscript Workflow with ZZCOLLAB}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

# Load required packages
library(knitr)
library(palmerpenguins)
library(ggplot2)
library(dplyr)

# Set up data for demonstration
morphology_data <- palmerpenguins::penguins %>%
  filter(!is.na(bill_length_mm), !is.na(bill_depth_mm), !is.na(body_mass_g))

# Define placeholder functions for demonstration
fit_allometry_model <- function(data, response, predictor, method = "lm", ...) {
  # Simplified allometry model for demonstration
  formula_str <- paste(response, "~", predictor)
  model <- lm(as.formula(formula_str), data = data)

  list(
    model = model,
    formula = formula_str,
    coefficients = coef(model),
    r_squared = summary(model)$r.squared,
    method = method
  )
}

generate_allometry_plot <- function(model_result, data) {
  # Simple scatter plot with regression line
  ggplot(data, aes_string(x = names(model_result$coefficients)[2],
                         y = names(model_result$coefficients)[1])) +
    geom_point() +
    geom_smooth(method = "lm") +
    theme_minimal()
}

# Additional placeholder functions for manuscript
compare_morphometric_models <- function(data, models) {
  list(best_model = "model1", aic_comparison = data.frame(model = c("model1", "model2"), aic = c(100, 105)))
}

format_descriptive_stats <- function(data) {
  data %>%
    summarise(across(where(is.numeric), list(mean = mean, sd = sd, n = length), na.rm = TRUE))
}
```

# Overview

This vignette demonstrates collaborative academic writing workflows using ZZCOLLAB's manuscript paradigm for multi-author research teams. The manuscript paradigm provides a complete research compendium structure that enables seamless collaboration on scholarly papers while ensuring complete reproducibility of analyses and results.

## Team Manuscript Paradigm Structure

Collaborative manuscript projects extend the solo structure with coordination mechanisms for multiple authors:

```
team-manuscript-project/
├── R/                          # Shared analysis functions (team-developed)
├── tests/testthat/             # Comprehensive function testing
├── man/                        # Auto-generated documentation
├── manuscript/                 # Collaborative writing space
│   ├── journal_templates/     # Journal-specific formatting
│   ├── paper.Rmd              # Primary manuscript file
│   ├── sections/              # Individual manuscript sections
│   │   ├── introduction.Rmd   # Author assignments
│   │   ├── methods.Rmd        # Methodology section
│   │   ├── results.Rmd        # Results presentation
│   │   └── discussion.Rmd     # Discussion and conclusions
│   ├── supplementary.Rmd      # Supplementary materials
│   └── references.bib         # Team bibliography management
├── analysis/reproduce/         # Complete reproduction pipeline
│   ├── 01_data_preparation.R  # Standardized data processing
│   ├── 02_statistical_analysis.R  # Core statistical analysis
│   ├── 03_figures_tables.R    # Publication-ready outputs
│   └── 04_manuscript_render.R # Automated manuscript generation
├── submission/                # Journal submission coordination
│   ├── figures/               # Final submission figures
│   ├── tables/                # Final submission tables
│   ├── supplementary/         # Supplementary materials
│   └── manuscript_versions/   # Journal-specific formats
├── data/
│   ├── raw_data/              # Original, untouched datasets
│   └── derived_data/          # Team-processed datasets
├── inst/examples/             # Reproducible examples
├── vignettes/                 # Extended methodology documentation
├── DESCRIPTION               # Package metadata with all authors
├── NAMESPACE                 # Function exports
└── zzcollab.yaml            # Team configuration
```

## Team Roles and Responsibilities

### Role 1: Principal Investigator (Project Lead)
**Responsibilities:**

- Create manuscript infrastructure and team coordination framework
- Manage manuscript timeline, author assignments, and submission process
- Coordinate with journal editors and handle peer review responses
- Ensure scientific rigor and maintain research integrity standards

**Skills Required:** Research leadership, project management, academic writing

### Role 2: Senior Authors (Content Leaders)
**Responsibilities:**

- Lead major manuscript sections (methods, results, discussion)
- Develop analysis functions with comprehensive documentation and testing
- Review and integrate contributions from junior authors
- Ensure methodological consistency and scientific accuracy across sections

**Skills Required:** Advanced research expertise, statistical analysis, academic writing

### Role 3: First Author (Primary Writer)
**Responsibilities:**
- Coordinate daily manuscript development and maintain writing timeline
- Integrate contributions from all co-authors into coherent narrative
- Manage bibliography, citations, and formatting standards
- Prepare submission packages and coordinate with journal requirements

**Skills Required:** Excellent writing skills, project coordination, attention to detail

### Role 4: Co-Authors (Specialist Contributors)
**Responsibilities:**
- Contribute specialized analysis, methodology, or domain expertise
- Write assigned manuscript sections following team standards
- Review and provide feedback on other authors' contributions
- Contribute to analysis functions and ensure reproducibility

**Skills Required:** Domain expertise, collaborative writing, peer review skills

### Role 5: Research Associates (Analysis Support)
**Responsibilities:**
- Execute analysis scripts and generate intermediate results
- Create publication-quality figures and tables following team standards
- Maintain data processing pipelines and ensure reproducibility
- Assist with literature review and reference management

**Skills Required:** Statistical analysis, data visualization, research methodology

## Collaborative Manuscript Development Workflow

### Phase 1: Principal Investigator Setup

The PI establishes the collaborative manuscript infrastructure:

```bash
# 1. Configure ZZCOLLAB for team manuscript development
zzcollab --config init
zzcollab --config set team-name "morphology-lab"
zzcollab --config set paradigm "manuscript"
zzcollab --config set build-mode "comprehensive"
zzcollab --config set github-account "morphology-lab"

# 2. Create team manuscript project with full infrastructure
zzcollab -i -p penguin-bill-morphology -P manuscript --github

# This creates:
# - Docker images: morphology-lab/penguin-bill-morphologycore-*:latest
# - GitHub repository: https://github.com/morphology-lab/penguin-bill-morphology
# - Complete research compendium structure with manuscript templates
# - CI/CD workflows for collaborative development and validation
# - Team coordination tools and review processes
```

### Phase 2: Author Onboarding and Role Assignment

Each team member joins the manuscript project:

```bash
# 1. Clone the team manuscript repository
git clone https://github.com/morphology-lab/penguin-bill-morphology.git
cd penguin-bill-morphology

# 2. Install ZZCOLLAB locally
git clone https://github.com/rgt47/zzcollab.git
cd zzcollab && ./install.sh
cd ../penguin-bill-morphology

# 3. Join the manuscript project
zzcollab -t morphology-lab -p penguin-bill-morphology -I verse

# This provides:
# - Access to identical LaTeX/publishing environment
# - All team packages for analysis and manuscript preparation
# - Shared bibliography and citation management tools
# - Collaborative writing environment with version control
```

### Phase 3: Collaborative Development Phases

#### Phase 3A: Analysis Development (All Authors)

**Principal Investigator: Research Coordination**

```bash
# Establish analysis framework and data management
make docker-zsh

# Set up team data standards
vim analysis/reproduce/01_data_preparation.R
```

**Team data preparation script:**

```r
#' Data Preparation for Penguin Bill Morphology Study
#' Team: morphology-lab
#' Authors: Dr. Smith (PI), Dr. Jones (Senior), M. Johnson (First Author)
#'
#' This script standardizes data processing across all team analyses
#' ensuring consistent results for manuscript preparation.

library(here)
library(dplyr)
library(palmerpenguins)

# Load team analysis functions
devtools::load_all()

# Team reproducibility standard
set.seed(123)

message("Initializing team data preparation...")

#' Prepare penguin morphology data following team standards
#' @return Standardized dataset for team analyses
prepare_team_morphology_data <- function() {
  penguins %>%
    # Apply team inclusion criteria
    filter(
      !is.na(bill_length_mm),
      !is.na(bill_depth_mm),
      !is.na(flipper_length_mm),
      !is.na(body_mass_g),
      !is.na(species),
      !is.na(island),
      !is.na(sex)
    ) %>%
    # Create team-standard derived variables
    mutate(
      bill_ratio = bill_depth_mm / bill_length_mm,
      log_body_mass = log(body_mass_g),
      species_island = paste(species, island, sep = "_"),
      size_category = case_when(
        body_mass_g < quantile(body_mass_g, 0.33) ~ "Small",
        body_mass_g < quantile(body_mass_g, 0.67) ~ "Medium",
        TRUE ~ "Large"
      )
    ) %>%
    # Team factor level standards
    mutate(
      species = factor(species, levels = c("Adelie", "Chinstrap", "Gentoo")),
      sex = factor(sex, levels = c("female", "male")),
      size_category = factor(size_category, levels = c("Small", "Medium", "Large"))
    )
}

# Prepare standardized dataset
morphology_data <- prepare_team_morphology_data()

# Team data quality validation
data_summary <- list(
  n_penguins = nrow(morphology_data),
  n_complete_cases = sum(complete.cases(morphology_data)),
  species_distribution = table(morphology_data$species),
  sex_distribution = table(morphology_data$sex),
  island_distribution = table(morphology_data$island),
  key_variables_summary = summary(select(morphology_data,
    bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g))
)

message("\nTeam Dataset Summary:")
message("  Total penguins: ", data_summary$n_penguins)
message("  Complete cases: ", data_summary$n_complete_cases)
print(data_summary$species_distribution)

# Save team-standard data
saveRDS(morphology_data, here("data", "processed", "team_morphology_data.rds"))
saveRDS(data_summary, here("analysis", "results", "data_summary.rds"))

# Generate data documentation for team
data_documentation <- list(
  dataset_name = "team_morphology_data.rds",
  description = "Standardized penguin morphology dataset for collaborative analysis",
  inclusion_criteria = "Complete measurements for all morphological variables",
  derived_variables = c("bill_ratio", "log_body_mass", "species_island", "size_category"),
  team_standards = "Fixed factor levels, standardized variable names, reproducible seed (123)",
  created_by = "Team data preparation script",
  created_date = Sys.Date(),
  n_observations = nrow(morphology_data),
  variables = names(morphology_data)
)

write_json(data_documentation, here("data", "processed", "data_documentation.json"),
           pretty = TRUE)

message("\nTeam data preparation completed!")
message("Standardized dataset ready for collaborative analysis")
```

```bash
# Commit team data standards
R
source("analysis/reproduce/01_data_preparation.R")
quit()

git add analysis/reproduce/01_data_preparation.R data/processed/
git commit -m "Establish team data preparation standards for morphology study

- Implement standardized data processing pipeline for all team analyses
- Define team inclusion criteria and derived variable calculations
- Create reproducible data documentation with complete metadata
- Generate team-wide data quality validation and summary statistics
- Fixed reproducibility seed (123) and factor level standards
- Dataset ready for collaborative manuscript development"

git push origin main
```

**Senior Author: Methodology Development**

```bash
# Develop statistical analysis functions for team use
make docker-zsh

git pull origin main  # Get latest team standards

vim R/morphology_analysis.R
```

**Team statistical analysis functions:**

```r
#' Statistical Analysis Functions for Penguin Morphology Study
#' Team: morphology-lab
#' Lead: Dr. Jones (Senior Author - Statistical Methods)
#'
#' This module implements statistical methods for collaborative manuscript
#' with comprehensive documentation and team testing standards.

#' Fit morphological allometry models with phylogenetic considerations
#'
#' @param data Penguin morphology dataset (team standard format)
#' @param response Response variable for allometric analysis
#' @param predictor Primary predictor variable
#' @param include_species Include species as random effect (default: TRUE)
#' @return List with model results, diagnostics, and interpretation
#' @export
#' @author Dr. Jones
#' @examples
#' data <- readRDS("data/processed/team_morphology_data.rds")
#' bill_allometry <- fit_allometry_model(data, "bill_depth_mm", "bill_length_mm")
fit_allometry_model <- function(data, response, predictor, include_species = TRUE) {
  # Input validation for team standards
  required_vars <- c(response, predictor, "species", "sex", "island")
  missing_vars <- setdiff(required_vars, names(data))
  if (length(missing_vars) > 0) {
    stop("Missing required variables: ", paste(missing_vars, collapse = ", "))
  }

  library(lme4)
  library(broom)
  library(broom.mixed)

  # Prepare modeling dataset
  model_data <- data %>%
    select(all_of(c(response, predictor, "species", "sex", "island"))) %>%
    filter(complete.cases(.)) %>%
    # Center and scale predictors for team interpretation standards
    mutate(
      !!paste0(predictor, "_centered") := scale(!!sym(predictor), scale = FALSE)[,1],
      !!paste0(predictor, "_scaled") := as.numeric(scale(!!sym(predictor)))
    )

  # Fit hierarchical model with team random effects structure
  if (include_species) {
    formula_str <- paste0(response, " ~ ", predictor, "_scaled + sex + (1|species) + (1|island)")
    model <- lmer(as.formula(formula_str), data = model_data)
  } else {
    formula_str <- paste0(response, " ~ ", predictor, "_scaled + sex + island")
    model <- lm(as.formula(formula_str), data = model_data)
  }

  # Extract results following team standards
  if (include_species) {
    model_summary <- tidy(model, effects = "fixed")
    random_effects <- tidy(model, effects = "ran_pars")
    model_fit <- glance(model)
  } else {
    model_summary <- tidy(model)
    random_effects <- NULL
    model_fit <- glance(model)
  }

  # Calculate effect sizes and confidence intervals
  effect_size <- model_summary %>%
    filter(term == paste0(predictor, "_scaled")) %>%
    mutate(
      cohen_d = estimate / model_fit$sigma,
      ci_lower = estimate - 1.96 * std.error,
      ci_upper = estimate + 1.96 * std.error
    )

  # Model diagnostics for team validation
  diagnostics <- list(
    residual_normality = shapiro.test(residuals(model))$p.value > 0.05,
    model_fit = if (include_species) model_fit$AIC else model_fit$adj.r.squared,
    sample_size = nrow(model_data),
    predictor_range = range(model_data[[predictor]], na.rm = TRUE)
  )

  # Return comprehensive results for team use
  list(
    model = model,
    summary = model_summary,
    random_effects = random_effects,
    effect_size = effect_size,
    diagnostics = diagnostics,
    data_info = list(
      response = response,
      predictor = predictor,
      n_observations = nrow(model_data),
      species_included = include_species
    ),
    team_metadata = list(
      author = "Dr. Jones",
      created = Sys.time(),
      r_version = R.version.string
    )
  )
}

#' Compare morphometric models across species
#'
#' @param data Penguin morphology dataset
#' @param models List of model specifications to compare
#' @return Model comparison table with AIC, effect sizes
#' @export
#' @author Dr. Jones
compare_morphometric_models <- function(data, models) {
  results <- map_dfr(models, function(model_spec) {
    result <- fit_allometry_model(data, model_spec$response,
                                 model_spec$predictor, model_spec$include_species)

    data.frame(
      response = result$data_info$response,
      predictor = result$data_info$predictor,
      species_effect = result$data_info$species_included,
      coefficient = result$effect_size$estimate,
      se = result$effect_size$std.error,
      p_value = result$effect_size$p.value,
      cohen_d = result$effect_size$cohen_d,
      aic = result$diagnostics$model_fit,
      n_obs = result$data_info$n_observations,
      stringsAsFactors = FALSE
    )
  }) %>%
  arrange(aic) %>%
  mutate(delta_aic = aic - min(aic),
         aic_rank = row_number())

  return(results)
}

#' Generate publication-ready morphometry table
#'
#' @param model_results Results from fit_allometry_model
#' @return Formatted table for manuscript inclusion
#' @export
#' @author Dr. Jones
format_morphometry_table <- function(model_results) {
  model_results$summary %>%
    filter(term != "(Intercept)") %>%
    mutate(
      estimate_formatted = paste0(sprintf("%.3f", estimate),
                                 " (", sprintf("%.3f", std.error), ")"),
      p_formatted = case_when(
        p.value < 0.001 ~ "< 0.001",
        p.value < 0.01 ~ "< 0.01",
        p.value < 0.05 ~ "< 0.05",
        TRUE ~ sprintf("%.3f", p.value)
      ),
      significance = case_when(
        p.value < 0.001 ~ "***",
        p.value < 0.01 ~ "**",
        p.value < 0.05 ~ "*",
        TRUE ~ ""
      )
    ) %>%
    select(term, estimate_formatted, p_formatted, significance) %>%
    rename(
      `Predictor` = term,
      `Coefficient (SE)` = estimate_formatted,
      `P-value` = p_formatted,
      ` ` = significance
    )
}
```

**Create comprehensive tests for team functions:**

```bash
vim tests/testthat/test-morphology_analysis.R
```

```r
# Team testing standards for morphology analysis functions
library(testthat)
library(palmerpenguins)

# Setup test data following team standards
setup_test_data <- function() {
  penguins %>%
    filter(!is.na(bill_length_mm), !is.na(bill_depth_mm),
           !is.na(species), !is.na(sex)) %>%
    slice_head(n = 100)  # Smaller dataset for faster testing
}

test_that("fit_allometry_model works with species effects", {
  test_data <- setup_test_data()

  result <- fit_allometry_model(test_data, "bill_depth_mm", "bill_length_mm",
                               include_species = TRUE)

  # Test return structure
  expect_type(result, "list")
  expect_true("model" %in% names(result))
  expect_true("summary" %in% names(result))
  expect_true("effect_size" %in% names(result))
  expect_true("diagnostics" %in% names(result))

  # Test model structure
  expect_s4_class(result$model, "lmerMod")
  expect_s3_class(result$summary, "data.frame")

  # Test effect size calculation
  expect_true("cohen_d" %in% names(result$effect_size))
  expect_true(is.numeric(result$effect_size$cohen_d))
})

test_that("fit_allometry_model works without species effects", {
  test_data <- setup_test_data()

  result <- fit_allometry_model(test_data, "bill_depth_mm", "bill_length_mm",
                               include_species = FALSE)

  expect_s3_class(result$model, "lm")
  expect_null(result$random_effects)
  expect_true("adj.r.squared" %in% names(result$diagnostics) ||
              "model_fit" %in% names(result$diagnostics))
})

test_that("fit_allometry_model validates input data", {
  incomplete_data <- data.frame(
    bill_depth_mm = c(15, 16, 17),
    # Missing bill_length_mm, species, sex, island
    other_var = c(1, 2, 3)
  )

  expect_error(
    fit_allometry_model(incomplete_data, "bill_depth_mm", "bill_length_mm"),
    "Missing required variables"
  )
})

test_that("compare_morphometric_models produces correct output", {
  test_data <- setup_test_data()

  models <- list(
    list(response = "bill_depth_mm", predictor = "bill_length_mm", include_species = TRUE),
    list(response = "bill_depth_mm", predictor = "flipper_length_mm", include_species = TRUE)
  )

  comparison <- compare_morphometric_models(test_data, models)

  expect_s3_class(comparison, "data.frame")
  expect_equal(nrow(comparison), 2)
  expect_true("aic_rank" %in% names(comparison))
  expect_true("delta_aic" %in% names(comparison))
  expect_equal(comparison$aic_rank, c(1, 2))
})

test_that("format_morphometry_table creates publication format", {
  test_data <- setup_test_data()

  result <- fit_allometry_model(test_data, "bill_depth_mm", "bill_length_mm")
  formatted_table <- format_morphometry_table(result)

  expect_s3_class(formatted_table, "data.frame")
  expect_true("Predictor" %in% names(formatted_table))
  expect_true("Coefficient (SE)" %in% names(formatted_table))
  expect_true("P-value" %in% names(formatted_table))

  # Check formatting
  expect_true(all(grepl("\\(.*\\)", formatted_table$`Coefficient (SE)`)))
})
```

```bash
# Test team functions and commit
R
devtools::load_all()
devtools::test()
quit()

git add R/morphology_analysis.R tests/testthat/test-morphology_analysis.R
git commit -m "Add comprehensive morphometric analysis functions for team manuscript

- Implement hierarchical allometry models with phylogenetic structure
- Add model comparison framework for multiple predictor evaluation
- Create publication-ready table formatting for manuscript inclusion
- Comprehensive testing suite validates all function behaviors
- Full documentation with author attribution and team metadata
- Functions ready for collaborative manuscript development"

git push origin main
```

#### Phase 3B: Collaborative Writing (Section-Based)

**First Author: Manuscript Structure and Introduction**

```bash
# Set up manuscript structure and writing framework
make docker-zsh

git pull origin main  # Get latest team functions

# Create section-based writing structure
mkdir -p manuscript/sections
vim manuscript/sections/introduction.Rmd
```

**Team introduction section:**

```yaml
# Introduction Section - Penguin Bill Morphology Study
# Lead Author: M. Johnson (First Author)
# Contributors: Dr. Smith (PI), Dr. Jones (Methods)

## Introduction

Avian bill morphology represents one of the most striking examples of adaptive radiation in vertebrate evolution [@Grant1986]. The relationship between bill dimensions and ecological function has been extensively documented across diverse bird species, yet the allometric relationships governing bill shape variation within populations remain less well characterized [@Schluter2000].

Palmer penguins (*Pygoscelis* spp.) provide an exceptional model system for investigating morphological variation due to their well-documented ecological differentiation and accessible study populations [@Gorman2014]. The three species within this genus—Adelie (*P. adeliae*), Chinstrap (*P. antarctica*), and Gentoo (*P. papua*) penguins—exhibit distinct bill morphologies that reflect their specialized feeding strategies and ecological niches [@Polito2011].

### Research Objectives

This study aims to quantify the allometric relationships governing bill morphology across Palmer penguin species, with specific focus on:

1. **Interspecific variation**: Characterizing species-specific allometric relationships between bill length and depth
2. **Sexual dimorphism**: Evaluating sex-based differences in morphological scaling relationships
3. **Phylogenetic structure**: Assessing the contribution of phylogenetic relatedness to morphological variation
4. **Ecological implications**: Interpreting morphological patterns in the context of feeding ecology and resource partitioning

### Analytical Framework

We employ a hierarchical modeling approach that accounts for the nested structure of morphological data (individuals within species within islands) while incorporating established allometric scaling principles [@Warton2006]. Our analysis framework integrates modern statistical methods with reproducible computational workflows to ensure robust inference and facilitate collaborative research.

The reproducible analysis pipeline implemented in this study follows established best practices for computational research [@Wilson2017] and enables complete replication of all results through standardized Docker environments and version-controlled analysis code.
```

**Co-Author: Methods Section Development**

```bash
# Senior author develops comprehensive methods section
vim manuscript/sections/methods.Rmd
```

**Team methods section:**

```yaml
# Methods Section - Statistical Analysis and Data Processing
# Lead Author: Dr. Jones (Senior Author)
# Contributors: Dr. Smith (Study Design), M. Johnson (Data Management)

## Methods

### Data Collection and Processing

Morphometric data were obtained from the Palmer Archipelago penguin dataset [@Horst2020], consisting of measurements from adult penguins collected at three research stations (Biscoe, Dream, and Torgersen islands) during the 2007-2009 breeding seasons. The dataset includes bill length (mm), bill depth (mm), flipper length (mm), and body mass (g) measurements for individuals across three congener species.

Data processing followed standardized protocols to ensure reproducibility and analytical consistency:

```{r data-processing, echo=TRUE, eval=FALSE}
# Load team-standardized dataset (demo code - file may not exist)
if (file.exists(here("data", "derived_data", "team_morphology_data.rds"))) {
  morphology_data <- readRDS(here("data", "derived_data", "team_morphology_data.rds"))
} else {
  # Use Palmer penguins data for demonstration
  morphology_data <- palmerpenguins::penguins
}

# Display data structure and summary statistics
cat("Dataset dimensions:", dim(morphology_data), "\n")
cat("Species distribution:\n")
print(table(morphology_data$species))
```

Quality control procedures included removal of individuals with incomplete measurements and standardization of morphometric variables following established allometric scaling principles [@Packard2009]. Derived variables included bill ratio (depth/length) and log-transformed body mass to address allometric scaling relationships.

### Statistical Analysis

#### Allometric Modeling Framework

Morphological relationships were analyzed using hierarchical linear mixed-effects models that account for the nested structure of the data (individuals within species within islands). The general model structure follows:

$$y_{ijk} = \beta_0 + \beta_1 x_{ijk} + \beta_2 \text{sex}_{ijk} + \alpha_i + \gamma_j + \epsilon_{ijk}$$

where $y_{ijk}$ represents the response variable (bill depth) for individual $k$ of species $i$ from island $j$, $x_{ijk}$ is the scaled predictor variable (bill length), $\alpha_i$ and $\gamma_j$ are random intercepts for species and island effects, and $\epsilon_{ijk}$ is the individual-level residual.

```{r allometry-example, echo=TRUE, eval=FALSE}
# Demonstrate team allometry modeling approach (example code)
# Note: This assumes morphology_data has been loaded in data-processing chunk

# example_model <- fit_allometry_model(
#   morphology_data,
#   response = "bill_depth_mm",
#   predictor = "bill_length_mm",
#   include_species = TRUE
# )

# For demonstration, use Palmer penguins data
example_data <- palmerpenguins::penguins %>% filter(!is.na(bill_depth_mm), !is.na(bill_length_mm))

example_model <- fit_allometry_model(
  example_data,
  response = "bill_depth_mm",
  predictor = "bill_length_mm"
)

# Display basic model summary
cat("Model R-squared:", round(example_model$r_squared, 3), "\n")
cat("Coefficients:", paste(round(example_model$coefficients, 3), collapse = ", "), "\n")
```

#### Model Selection and Validation

Model selection followed information-theoretic approaches using Akaike Information Criterion (AIC) to evaluate alternative model structures [@Burnham2002]. Model validation included assessment of residual normality, homoscedasticity, and random effect structure appropriateness.

Effect sizes were calculated as standardized coefficients (Cohen's d) to facilitate interpretation and comparison across variables [@Cohen1988]. Confidence intervals were computed using parametric bootstrap procedures (*n* = 1000 iterations) to account for uncertainty in random effect estimates.

### Reproducible Analysis Framework

All analyses were conducted within standardized Docker containers (zzcollab framework) ensuring computational reproducibility across different computing environments [@Boettiger2015]. The complete analysis pipeline is version-controlled and available through the project GitHub repository, enabling full replication of all results.

```{r session-info}
# Document computational environment for reproducibility
sessionInfo()
```
```

**Research Associate: Results Section Development**

```bash
# Develop results section with team analysis integration
vim manuscript/sections/results.Rmd
```

**Team results section:**

```yaml
# Results Section - Morphological Analysis Results
# Lead Author: Research Associate
# Contributors: All team members (analysis integration)

## Results

### Morphometric Dataset Characteristics

The final dataset comprised `r nrow(morphology_data)` individual penguins with complete morphometric measurements across three species and three islands. Species distribution was approximately balanced, with Adelie penguins comprising `r round(mean(morphology_data$species == "Adelie") * 100, 1)`% (*n* = `r sum(morphology_data$species == "Adelie")`), Chinstrap penguins `r round(mean(morphology_data$species == "Chinstrap") * 100, 1)`% (*n* = `r sum(morphology_data$species == "Chinstrap")`), and Gentoo penguins `r round(mean(morphology_data$species == "Gentoo") * 100, 1)`% (*n* = `r sum(morphology_data$species == "Gentoo")`) of the sample.

```{r descriptive-stats, echo=FALSE}
# Generate team-standard descriptive statistics
descriptive_stats <- morphology_data %>%
  group_by(species, sex) %>%
  summarise(
    n = n(),
    bill_length_mean = round(mean(bill_length_mm), 1),
    bill_length_sd = round(sd(bill_length_mm), 1),
    bill_depth_mean = round(mean(bill_depth_mm), 1),
    bill_depth_sd = round(sd(bill_depth_mm), 1),
    .groups = "drop"
  )

kable(descriptive_stats,
      caption = "Descriptive statistics for bill morphology by species and sex",
      col.names = c("Species", "Sex", "N", "Length Mean", "Length SD",
                   "Depth Mean", "Depth SD"))
```

### Allometric Relationships

#### Primary Allometric Analysis

Bill depth demonstrated significant positive allometric relationships with bill length across all species (Figure \@ref(fig:allometry-plot)). The hierarchical model incorporating species and island random effects provided superior fit compared to fixed-effects alternatives (ΔAIC = 47.3, *p* < 0.001).

```{r allometry-analysis, echo=FALSE}
# Run comprehensive allometric analysis using team functions
primary_model <- fit_allometry_model(
  morphology_data,
  response = "bill_depth_mm",
  predictor = "bill_length_mm",
  include_species = TRUE
)

# Extract key results for text integration
effect_size <- primary_model$effect_size$cohen_d
p_value <- primary_model$effect_size$p.value
r_squared <- primary_model$diagnostics$model_fit
```

The standardized coefficient for bill length was `r sprintf("%.3f", primary_model$effect_size$estimate)` (SE = `r sprintf("%.3f", primary_model$effect_size$std.error)`, *p* `r if(p_value < 0.001) "< 0.001" else paste("=", sprintf("%.3f", p_value))`, Cohen's d = `r sprintf("%.2f", effect_size)`), indicating a large effect size according to conventional interpretational guidelines [@Cohen1988].

```{r allometry-plot, fig.cap="Allometric relationships between bill length and bill depth across Palmer penguin species. Points represent individual measurements colored by species. Fitted lines show species-specific allometric trajectories with 95% confidence intervals.", echo=FALSE}
# Generate publication-quality allometric visualization
allometry_plot <- morphology_data %>%
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +
  geom_point(alpha = 0.6, size = 1.5) +
  geom_smooth(method = "lm", se = TRUE, alpha = 0.3) +
  facet_wrap(~ species, scales = "free") +
  scale_color_manual(values = c("Adelie" = "#FF6B35",
                               "Chinstrap" = "#004E89",
                               "Gentoo" = "#009E73")) +
  labs(
    x = "Bill Length (mm)",
    y = "Bill Depth (mm)",
    color = "Species"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text = element_text(face = "bold")
  )

print(allometry_plot)
```

#### Sexual Dimorphism Analysis

Sexual dimorphism was evident across all species, with males exhibiting consistently larger bill dimensions than females (Table \@ref(tab:sexual-dimorphism)). The magnitude of sexual size dimorphism varied among species, with Gentoo penguins showing the most pronounced dimorphism (male-female difference: `r sprintf("%.1f", max(descriptive_stats$bill_length_mean[descriptive_stats$species == "Gentoo"]) - min(descriptive_stats$bill_length_mean[descriptive_stats$species == "Gentoo"]))` mm bill length, `r sprintf("%.1f", max(descriptive_stats$bill_depth_mean[descriptive_stats$species == "Gentoo"]) - min(descriptive_stats$bill_depth_mean[descriptive_stats$species == "Gentoo"]))` mm bill depth).

```{r sexual-dimorphism, echo=FALSE}
# Analyze sexual dimorphism using team functions
dimorphism_models <- list(
  list(response = "bill_length_mm", predictor = "body_mass_g", include_species = TRUE),
  list(response = "bill_depth_mm", predictor = "body_mass_g", include_species = TRUE)
)

dimorphism_results <- compare_morphometric_models(morphology_data, dimorphism_models)

kable(dimorphism_results %>% select(response, coefficient, se, p_value, aic_rank),
      caption = "Sexual dimorphism analysis results",
      col.names = c("Response Variable", "Coefficient", "SE", "P-value", "AIC Rank"))
```

### Phylogenetic Structure

Species-level random effects accounted for `r sprintf("%.1f", (primary_model$random_effects %>% filter(group == "species"))$estimate * 100)`% of total morphological variance, indicating substantial phylogenetic signal in bill morphology. Island effects were minimal (`r sprintf("%.1f", (primary_model$random_effects %>% filter(group == "island"))$estimate * 100)`% of variance), suggesting that local environmental variation has limited impact on bill dimensions relative to species-specific differences.

### Model Validation Results

Residual analysis confirmed model assumptions were satisfied. Shapiro-Wilk tests indicated normal distribution of residuals (*W* = 0.998, *p* = 0.16), and visual inspection revealed homoscedastic residual patterns. Cook's distance analysis identified no influential outliers (all D < 0.1).

```{r model-diagnostics, fig.cap="Model diagnostic plots showing residual patterns and random effect distributions.", echo=FALSE}
# Generate comprehensive model diagnostics
library(performance)
library(patchwork)

diagnostic_plots <- plot(check_model(primary_model$model))
print(diagnostic_plots)
```
```

#### Phase 3C: Integration and Review

**First Author: Manuscript Integration and Coordination**

```bash
# Integrate all sections into coherent manuscript
vim manuscript/main.Rmd
```

**Master manuscript file:**

```yaml
---
title: "Allometric Scaling of Bill Morphology in Palmer Penguins: A Hierarchical Analysis of Interspecific and Sexual Variation"
author:
  - name: "Margaret Johnson"
    email: "m.johnson@morphology-lab.edu"
    affiliation: "Department of Biology, Morphology Laboratory"
    orcid: "0000-0000-0000-0001"
    role: "First Author"
  - name: "Dr. Sarah Smith"
    email: "s.smith@morphology-lab.edu"
    affiliation: "Department of Biology, Morphology Laboratory"
    orcid: "0000-0000-0000-0002"
    role: "Principal Investigator"
  - name: "Dr. Robert Jones"
    email: "r.jones@morphology-lab.edu"
    affiliation: "Department of Statistics, Morphology Laboratory"
    orcid: "0000-0000-0000-0003"
    role: "Senior Author - Statistical Methods"
  - name: "Alex Chen"
    email: "a.chen@morphology-lab.edu"
    affiliation: "Department of Biology, Morphology Laboratory"
    orcid: "0000-0000-0000-0004"
    role: "Research Associate - Data Analysis"
date: "`r Sys.Date()`"
output:
  bookdown::pdf_document2:
    latex_engine: xelatex
    number_sections: true
    toc: false
  bookdown::html_document2:
    number_sections: true
    toc: true
    toc_float: true
  bookdown::word_document2:
    reference_docx: "templates/manuscript_template.docx"
    number_sections: true
bibliography: references.bib
csl: "templates/ecology-letters.csl"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE,
                     fig.width = 8, fig.height = 6, dpi = 300)

# Load all team packages and functions
library(zzcollab)
library(here)
library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(patchwork)

# Load team functions and data
devtools::load_all()
morphology_data <- readRDS(here("data", "processed", "team_morphology_data.rds"))

# Set team figure theme
theme_set(theme_minimal() +
  theme(plot.title = element_text(size = 12, face = "bold")))
```

# Abstract

Morphological scaling relationships provide fundamental insights into evolutionary constraints and adaptive radiation in vertebrates. We analyzed allometric patterns in bill morphology across three Palmer penguin species (*Pygoscelis* spp.) using hierarchical modeling approaches that account for phylogenetic structure and sexual dimorphism. Analysis of `r nrow(morphology_data)` individuals revealed significant positive allometric scaling between bill depth and length (standardized coefficient = `r sprintf("%.3f", primary_model$effect_size$estimate)`, Cohen's d = `r sprintf("%.2f", primary_model$effect_size$cohen_d)`, *p* < 0.001). Species-level variation accounted for `r sprintf("%.1f", (primary_model$random_effects %>% filter(group == "species"))$estimate * 100)`% of morphological variance, indicating strong phylogenetic signal. Sexual dimorphism was consistent across species, with males exhibiting 8-12% larger bill dimensions. Our findings demonstrate that bill morphology in Palmer penguins follows predictable allometric scaling relationships while maintaining species-specific adaptations for ecological specialization.

**Keywords:** allometry, sexual dimorphism, morphometry, penguins, phylogenetic analysis

```{r child = "sections/introduction.Rmd"}
```

```{r child = "sections/methods.Rmd"}
```

```{r child = "sections/results.Rmd"}
```

```{r child = "sections/discussion.Rmd"}
```

# Acknowledgments

We thank the Palmer Station research community for data collection efforts and the LTER program for long-term ecological monitoring. Statistical analysis was conducted using the ZZCOLLAB reproducible research framework. All authors contributed to study design, data analysis, and manuscript preparation.

# Author Contributions

**MJ**: First author, manuscript writing, data analysis integration, project coordination
**SS**: Principal investigator, study design, research oversight, manuscript review
**RJ**: Senior author, statistical methodology, model development, results interpretation
**AC**: Research associate, data processing, visualization, quality assurance

# Data Availability Statement

All data and analysis code are available through the project GitHub repository (https://github.com/morphology-lab/penguin-bill-morphology). The complete reproducible analysis environment is accessible via Docker containers following ZZCOLLAB framework standards.

# References

::: {#refs}
:::

# Supplementary Materials

See accompanying supplementary materials document for additional analyses, model diagnostics, and sensitivity testing results.

## Reproducibility Information

This manuscript was generated using a fully reproducible workflow with the following computational environment:

```{r reproducibility-info}
# Document complete computational environment
cat("Generated:", format(Sys.time(), "%Y-%m-%d %H:%M:%S %Z"), "\n")
cat("ZZCOLLAB version:", packageVersion("zzcollab"), "\n")
print(sessionInfo())
```
```

**Principal Investigator: Final Review and Submission Coordination**

```bash
# Coordinate final manuscript review and submission
make docker-zsh

# Render complete manuscript in all formats
R
rmarkdown::render("manuscript/main.Rmd", output_format = "all")

# Generate supplementary materials
rmarkdown::render("manuscript/supplementary.Rmd")
quit()

# Validate complete reproducibility
source("analysis/reproduce/04_manuscript_render.R")

# Final validation tests
make docker-test
make docker-check

# Prepare submission package
mkdir -p submission/ecology-letters/
cp manuscript/main.pdf submission/ecology-letters/main_manuscript.pdf
cp manuscript/supplementary.pdf submission/ecology-letters/supplementary_materials.pdf
cp -r manuscript/figures/ submission/ecology-letters/
cp manuscript/references.bib submission/ecology-letters/

# Create research compendium archive
tar -czf submission/research_compendium.tar.gz R/ data/ analysis/ tests/ manuscript/

# Final commit with all authors
git add .
git commit -m "Complete collaborative manuscript ready for submission

Authors: Johnson (First), Smith (PI), Jones (Senior), Chen (RA)

- Comprehensive allometric analysis of Palmer penguin bill morphology
- Hierarchical modeling with phylogenetic and sexual dimorphism effects
- Complete reproducible analysis pipeline with team validation
- Publication-ready manuscript with author contributions documented
- All supplementary materials and research compendium included
- Submission package prepared for Ecology Letters

Team coordination and reproducibility validated across all environments."

git push origin main

# Create submission tag
git tag -a v1.0-submission -m "Manuscript submission version 1.0"
git push origin v1.0-submission
```

## Benefits of Team Manuscript Workflow

### Collaborative Writing Advantages

- **Section-Based Development**: Authors work simultaneously on different sections with clear ownership and coordination
- **Version Control Integration**: Complete history of all author contributions with attribution and review process
- **Reproducible Analysis Integration**: All results generated programmatically and updated automatically across manuscript
- **Automated Bibliography Management**: Shared references.bib with team coordination and duplicate detection
- **Multi-Format Output**: Simultaneous generation of PDF, HTML, and Word versions for different review stages

### Academic Collaboration Features

- **Author Attribution System**: Clear documentation of individual contributions and expertise areas
- **Peer Review Coordination**: Structured review process with version control and issue tracking
- **Submission Package Generation**: Automated creation of journal-specific submission packages
- **Research Compendium**: Complete reproducible research package including data, code, and documentation
- **Citation Integration**: Automatic citation formatting and reference list generation

### Professional Standards

- **Reproducible Research**: All analyses reproducible by any team member or external reviewer
- **Quality Assurance**: Comprehensive testing ensures all analysis functions perform correctly
- **Documentation Standards**: All functions documented following academic standards with author attribution
- **Submission Readiness**: Manuscript automatically formatted for target journals with complete metadata

The team manuscript paradigm provides a comprehensive framework for collaborative academic writing that ensures reproducible research, maintains individual authorship recognition, and facilitates professional publication workflows.