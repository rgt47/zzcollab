---
title: "ZZCOLLAB Configuration System"
author: "ZZCOLLAB Development Team"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
vignette: >
  %\VignetteIndexEntry{ZZCOLLAB Configuration System}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

# Overview

ZZCOLLAB features a sophisticated multi-layered configuration system that controls Docker images, R packages, build modes, and team collaboration settings. This system enables teams to create reproducible, customized research environments while eliminating repetitive manual configuration.

## Key Benefits

- **‚úì Eliminate repetitive typing**: Set defaults once, use across all projects
- **‚úì Team standardization**: Shared configurations ensure identical environments
- **‚úì Flexible customization**: 14+ Docker profiles, custom package lists, build modes
- **‚úì Hierarchical control**: User, project, and system-level configurations
- **‚úì Single source of truth**: Centralized profile definitions prevent duplication

# Configuration Architecture

## Multi-Level Hierarchy

ZZCOLLAB loads configuration from multiple sources in priority order:

1. **Project config** (`./zzcollab.yaml`) - Team-specific settings for shared projects
2. **User config** (`~/.zzcollab/config.yaml`) - Personal defaults across all projects
3. **System config** (`/etc/zzcollab/config.yaml`) - Organization-wide defaults
4. **Built-in defaults** - Fallback values ensuring system functionality

Higher priority configurations override lower priority ones, allowing for precise control at each level.

## Three Configuration Domains

### Docker Variant Management
Control which specialized Docker environments your team uses:
- **14+ predefined variants** from minimal (~200MB Alpine) to comprehensive (~3.5GB full-featured)
- **Domain-specific environments** for bioinformatics, geospatial analysis, machine learning
- **Single source of truth** architecture eliminates duplication
- **Interactive profile browser** for easy discovery and selection

### Package Management System
Control what R packages are installed and when:
- **Build mode control**: Fast (9 packages) vs Standard (17 packages) vs Comprehensive (51 packages)
- **Unified package selection**: All research workflows supported (data analysis, manuscript writing, package development)
- **Custom package lists**: Define your own combinations for specialized workflows
- **Dependency management**: Docker packages vs renv packages with proper separation

### Development & Collaboration Settings
Control team workflows and automation:
- **GitHub integration**: Automatic repository creation, visibility settings, Actions enablement
- **Container defaults**: User accounts, working directories, shared volumes
- **Development preferences**: Default interfaces, dotfiles handling, confirmation prompts

# Docker Profile System

## Understanding Variants

Docker profiles are pre-configured environments with specific base images, R packages, and system dependencies. Each profile is optimized for particular research workflows.

### Variant Categories

**Standard Research Environments (6 variants)**
```yaml
minimal:          # ~800MB  - Essential R packages only
analysis:         # ~1.2GB  - Tidyverse + data analysis tools
modeling:         # ~1.5GB  - Machine learning with tidymodels
publishing:       # ~3GB    - LaTeX, Quarto, bookdown, blogdown
shiny:            # ~1.8GB  - Interactive web applications
shiny_verse:      # ~3.5GB  - Shiny with tidyverse + publishing
```

**Specialized Domains (2 variants)**
```yaml
bioinformatics:   # ~2GB    - Bioconductor genomics packages
geospatial:       # ~2.5GB  - sf, terra, leaflet mapping tools
```

**üèî Lightweight Alpine Variants (3 profiles)**
```yaml
alpine_minimal:   # ~200MB  - Ultra-lightweight for CI/CD
alpine_analysis:  # ~400MB  - Essential analysis in tiny container
hpc_alpine:       # ~600MB  - High-performance parallel processing
```

**R-Hub Testing Environments (3 profiles)**
```yaml
rhub_ubuntu:      # ~1GB    - CRAN-compatible package testing
rhub_fedora:      # ~1.2GB  - Test against R-devel
rhub_windows:     # ~1.5GB  - Windows compatibility testing
```

## Single Source of Truth Architecture

### Master Variant Library

All profile definitions are stored in `templates/profiles.yaml`:

```yaml
# Example profile definition
analysis:
  base_image: "rocker/tidyverse:latest"
  description: "Data analysis environment with tidyverse and common packages"
  packages:
    - "renv"
    - "devtools"
    - "here"
    - "janitor"
    - "scales"
    - "patchwork"
    - "gt"
    - "DT"
  system_deps:
    - "libxml2-dev"
    - "libcurl4-openssl-dev"
    - "libssl-dev"
  category: "standard"
  size: "~1.2GB"
```

### Team Configuration Selection

Teams select which variants to enable in their `config.yaml`:

```yaml
profiles:
  analysis:
    enabled: true    # Enable this profile for the team
    # Full definition automatically pulled from profiles.yaml

  modeling:
    enabled: false   # Disable this profile (will not be built)

  custom_ml:
    enabled: true
    # Can override or extend definitions from the library
    packages: ["additional_package"]
```

## Interactive Variant Management

### Using the Variant Browser

The `./add_profile.sh` script provides an interactive interface for profile selection:

```bash
cd your-project
./add_profile.sh
```

This displays a categorized menu:

```
STANDARD RESEARCH ENVIRONMENTS
 1) minimal          ~800MB  - Essential R packages only
 2) analysis         ~1.2GB  - Tidyverse + data analysis
 3) modeling         ~1.5GB  - Machine learning with tidymodels

SPECIALIZED DOMAINS
 7) bioinformatics   ~2GB    - Bioconductor genomics packages
 8) geospatial       ~2.5GB  - sf, terra, leaflet mapping

LIGHTWEIGHT ALPINE VARIANTS
 9) alpine_minimal   ~200MB  - Ultra-lightweight CI/CD
10) alpine_analysis  ~400MB  - Essential analysis in tiny container

Select variants to add (e.g., 1,3,9):
```

Selected variants are automatically added to your `config.yaml` with `enabled: true`.

### Manual Variant Management

You can also edit variants directly in `config.yaml`:

```yaml
profiles:
  # Standard environments
  minimal:
    enabled: true     # Essential development
  analysis:
    enabled: true     # Primary data analysis
  modeling:
    enabled: false    # Machine learning (disabled)

  # Specialized environments
  bioinformatics:
    enabled: true     # Genomics analysis
  alpine_minimal:
    enabled: true     # Lightweight CI/CD
```

## Custom Variant Creation

### Extending Existing Variants

Add packages to existing profiles:

```yaml
profiles:
  analysis:
    enabled: true
    # Extend the base analysis variant
    additional_packages:
      - "pins"
      - "vetiver"
      - "plumber"
```

### Creating New Variants

Define completely custom profiles:

```yaml
profiles:
  custom_forecast:
    enabled: true
    base_image: "rocker/r-ver:latest"
    description: "Time series forecasting environment"
    packages:
      - "renv"
      - "devtools"
      - "tidyverse"
      - "forecast"
      - "fable"
      - "tsibble"
      - "feasts"
    system_deps:
      - "libxml2-dev"
      - "libssl-dev"
    category: "custom"
    size: "~1.3GB"
```

# Package Management System

## Build Mode Package Control

ZZCOLLAB provides three build modes that control the number and type of packages installed:

### Fast Mode (-F): 9 Essential Packages
```r
# Core development packages only
packages <- c(
  "renv", "here", "usethis", "devtools",
  "testthat", "knitr", "rmarkdown", "targets"
)
```

**Use cases**:
- Quick prototyping and testing
- CI/CD pipelines requiring fast builds
- Resource-constrained environments
- Initial project setup

### Standard Mode (-S): 17 Balanced Packages (Default)
```r
# Essential + common analysis packages
packages <- c(
  # Fast mode packages
  "renv", "here", "usethis", "devtools", "testthat",
  "knitr", "rmarkdown", "targets",
  # Additional analysis packages
  "dplyr", "ggplot2", "tidyr", "palmerpenguins",
  "broom", "janitor", "DT", "conflicted"
)
```

**Use cases**:
- Most research projects and data analysis
- Balanced functionality vs build time
- Team development environments
- Standard exploratory data analysis

### Comprehensive Mode (-C): 47+ Full Packages
```r
# Complete development and analysis ecosystem
packages <- c(
  # Standard mode packages + advanced tools
  "tidymodels", "shiny", "plotly", "quarto",
  "flexdashboard", "survival", "lme4", "car",
  "naniar", "skimr", "visdat", "ggthemes",
  "kableExtra", "bookdown", "jsonlite", "datapasta",
  # Database and web packages
  "DBI", "RMariaDB", "RPostgreSQL", "httr", "rvest"
)
```

**Use cases**:
- Comprehensive research environments
- Complete research lifecycle support (data ‚Üí analysis ‚Üí paper ‚Üí package)
- Teaching environments with diverse package needs
- Production analysis environments

## Package Selection by Build Mode

The unified paradigm uses build modes to control package selection, with comprehensive mode including all packages needed for data analysis, manuscript writing, and package development:

**Fast Mode (9 packages)**:
```r
fast_packages <- c(
  "renv", "here", "usethis", "devtools",
  "testthat", "knitr", "rmarkdown", "targets"
)
```

**Standard Mode (17 packages)**:
```r
standard_packages <- c(
  # Fast packages plus:
  "dplyr", "ggplot2", "tidyr", "palmerpenguins",
  "broom", "janitor", "DT", "conflicted"
)
```

**Comprehensive Mode (51 packages)**:
```r
comprehensive_packages <- c(
  # Standard packages plus:
  # Analysis: tidymodels, shiny, plotly, quarto, flexdashboard, survival, lme4
  # Manuscript: bookdown, papaja, RefManageR, citr
  # Package: roxygen2, pkgdown, covr, lintr, goodpractice, spelling
  # Plus: databases, parallel processing, visualization tools
)
```

## Custom Package Lists

### User-Level Custom Packages

Define personal package preferences in `~/.zzcollab/config.yaml`:

```yaml
build_modes:
  my_datascience:
    description: "Personal data science workflow"
    docker_packages:
      - "renv"
      - "tidyverse"
      - "targets"
      - "pins"
    renv_packages:
      - "renv"
      - "tidyverse"
      - "targets"
      - "pins"
      - "vetiver"
      - "plumber"
      - "shiny"
      - "shinydashboard"

  my_stats:
    description: "Statistical analysis focus"
    docker_packages:
      - "renv"
      - "tidyverse"
      - "broom"
    renv_packages:
      - "renv"
      - "tidyverse"
      - "broom"
      - "lme4"
      - "survival"
      - "car"
      - "emmeans"
```

### Project-Level Custom Packages

Override defaults for specific projects in `./zzcollab.yaml`:

```yaml
build_modes:
  project_specific:
    description: "Customer churn analysis packages"
    docker_packages:
      - "renv"
      - "tidyverse"
      - "tidymodels"
    renv_packages:
      - "renv"
      - "tidyverse"
      - "tidymodels"
      - "probably"
      - "workflowsets"
      - "tune"
      - "recipes"
      - "parsnip"
      - "yardstick"
```

### Package Installation Separation

ZZCOLLAB distinguishes between two types of package installations:

**Docker Packages** (`docker_packages`):
- Installed during Docker image build
- Available immediately when container starts
- Shared across all users of the image
- Should include essential packages needed by everyone

**renv Packages** (`renv_packages`):
- Managed by renv for reproducibility
- Project-specific and version-locked
- Include analysis-specific packages
- Allow for precise dependency management

```yaml
build_modes:
  optimal_separation:
    description: "Proper package separation example"
    docker_packages:
      # Essential system packages everyone needs
      - "renv"          # Package management
      - "devtools"      # Development tools
      - "here"          # Path management
      - "conflicted"    # Namespace conflicts
    renv_packages:
      # Project-specific analysis packages
      - "renv"
      - "tidyverse"     # Data analysis
      - "targets"       # Workflow management
      - "palmerpenguins" # Example data
      - "specific_analysis_package"
```

# Team Collaboration Configuration

## GitHub Integration

ZZCOLLAB provides extensive GitHub integration through configuration:

### Repository Management

```yaml
collaboration:
  github:
    auto_create_repo: true          # Automatically create GitHub repositories
    default_visibility: "private"   # Repository visibility (private/public)
    enable_actions: true            # Enable GitHub Actions CI/CD
    branch_protection: true         # Enable branch protection rules

    # Default repository settings
    repository:
      allow_merge_commits: true
      allow_squash_merging: true
      allow_rebase_merging: false
      delete_head_branches: true
```

### Issue and PR Templates

```yaml
collaboration:
  github:
    templates:
      # Enable issue templates
      issue_templates: true

      # Enable pull request template
      pr_template: true

      # Custom template directory
      template_dir: ".github/ISSUE_TEMPLATE"
```

## Development Environment Defaults

### Container Configuration

```yaml
development:
  # Default profile for team members joining
  default_interface: "analysis"

  # Container user and environment settings
  container:
    default_user: "analyst"
    working_dir: "/home/analyst/project"
    shared_volumes:
      - "${PWD}:/home/analyst/project"
      - "${HOME}/.ssh:/home/analyst/.ssh:ro"

  # Dotfiles handling
  dotfiles:
    auto_filter_macos: true      # Filter macOS-specific commands for Docker
    preserve_permissions: true   # Maintain file permissions
    include_hidden: true         # Include hidden dotfiles
```

### Build and Platform Settings

```yaml
build:
  # Docker build configuration
  docker:
    platform: "auto"            # auto, linux/amd64, linux/arm64
    no_cache: false             # Enable Docker build caching
    parallel_builds: true       # Build profiles in parallel
    memory_limit: "4g"          # Memory limit for builds

  # Package installation settings
  packages:
    repos: "https://cran.rstudio.com/"
    install_suggests: false
    dependencies: ["Depends", "Imports", "LinkingTo"]
    parallel_installs: true
```

## Documentation Settings

### Automatic Documentation Generation

```yaml
collaboration:
  documentation:
    auto_generate_readme: true       # Generate project README
    include_variant_docs: true       # Document available profiles
    update_user_guide: true          # Include ZZCOLLAB_USER_GUIDE.md

    # Documentation templates
    readme_template: "README_TEMPLATE.md"
    contributing_guide: true
    code_of_conduct: true
```

# Practical Configuration Workflows

## Solo Developer Workflow

### Initial Setup

```bash
# 1. Initialize personal configuration
zzcollab --config init

# 2. Set personal preferences
zzcollab --config set team-name "myteam"
zzcollab --config set github-account "myusername"
zzcollab --config set build-mode "standard"
zzcollab --config set dotfiles-dir "~/dotfiles"
```

### Custom Package Configuration

Edit `~/.zzcollab/config.yaml`:

```yaml
defaults:
  team_name: "myteam"
  build_mode: "my_custom"

build_modes:
  my_custom:
    description: "My personal data science stack"
    docker_packages: ["renv", "tidyverse", "here", "conflicted"]
    renv_packages: ["renv", "tidyverse", "targets", "pins", "vetiver"]
```

### Project Creation

```bash
# Create project using personal defaults
zzcollab -i -p my-analysis

# Customize variants for this specific project
cd my-analysis
./add_profile.sh    # Add alpine_minimal for CI/CD testing
```

## Team Leader Workflow

### Team Configuration Setup

```bash
# 1. Create team project directory
mkdir customer-churn-analysis
cd customer-churn-analysis

# 2. Initialize with base configuration
zzcollab -i -p customer-churn-analysis
```

### Customize Team Variants

Edit the generated `config.yaml`:

```yaml
team:
  name: "datasci-lab"
  project: "customer-churn-analysis"
  description: "ML analysis of customer retention patterns"

profiles:
  # Core development environment
  minimal:
    enabled: true    # For quick testing and CI/CD

  # Primary analysis environment
  analysis:
    enabled: true    # Main development interface

  # Machine learning environment
  modeling:
    enabled: true    # For model development and evaluation

  # Alpine for CI/CD
  alpine_minimal:
    enabled: true    # Fast CI/CD testing

  # Optional environments (disabled by default)
  publishing:
    enabled: false   # Enable when needed for reports
  geospatial:
    enabled: false   # Not needed for this project

collaboration:
  github:
    auto_create_repo: true
    default_visibility: "private"
    enable_actions: true

  development:
    default_interface: "analysis"
```

### Build and Deploy Team Images

```bash
# Build team images with custom configuration
zzcollab --variants-config config.yaml --github

# Push to GitHub and Docker Hub
git add . && git commit -m "Initial team configuration"
git push origin main
```

## Team Member Workflow

### Joining an Existing Team Project

```bash
# 1. Clone team repository
git clone https://github.com/datasci-lab/customer-churn-analysis.git
cd customer-churn-analysis

# 2. Join using team's preferred interface
zzcollab -t datasci-lab -p customer-churn-analysis -I analysis

# 3. Start development environment
make docker-zsh
```

### Understanding Team Configuration

```bash
# View team's available profiles
zzcollab --config list

# See which Docker images are available
docker images | grep datasci-lab

# Check team's package configuration
cat config.yaml | grep -A 20 "build:"
```

### Working with Multiple Interfaces

```bash
# Use analysis environment for daily work
zzcollab -t datasci-lab -p customer-churn-analysis -I analysis
make docker-zsh

# Switch to modeling environment for ML work
exit  # Exit current container
zzcollab -t datasci-lab -p customer-churn-analysis -I modeling
make docker-zsh

# Use minimal environment for testing
exit
zzcollab -t datasci-lab -p customer-churn-analysis -I minimal
make docker-test
```

## Advanced Custom Variant Workflow

### Creating Organization-Specific Variants

```bash
# 1. Copy and customize profile library
cp templates/profiles.yaml custom_variants.yaml
```

Edit `custom_variants.yaml` to add organization profiles:

```yaml
# Add to existing variants
org_finance:
  base_image: "rocker/r-ver:latest"
  description: "Financial analysis environment with specialized packages"
  packages:
    - "renv"
    - "devtools"
    - "tidyverse"
    - "tidyquant"
    - "quantmod"
    - "PerformanceAnalytics"
    - "RQuantLib"
    - "timeDate"
  system_deps:
    - "libxml2-dev"
    - "libssl-dev"
    - "libcurl4-openssl-dev"
  category: "specialized"
  size: "~1.8GB"

org_research:
  base_image: "rocker/verse:latest"
  description: "Academic research environment with LaTeX and publishing tools"
  packages:
    - "renv"
    - "devtools"
    - "tidyverse"
    - "rmarkdown"
    - "bookdown"
    - "papaja"
    - "RefManageR"
    - "citr"
  system_deps:
    - "texlive-full"
    - "pandoc"
  category: "specialized"
  size: "~4GB"
```

### Using Custom Variant Library

Edit team `config.yaml`:

```yaml
build:
  use_config_profiles: true
  variant_library: "custom_variants.yaml"  # Use custom library

profiles:
  minimal:
    enabled: true
  org_finance:
    enabled: true    # Use custom finance variant
  org_research:
    enabled: true    # Use custom research variant
```

### Building and Sharing Custom Variants

```bash
# Build with custom profile library
zzcollab --variants-config config.yaml

# Verify custom images were created
docker images | grep finance
docker images | grep research

# Share custom profile library with organization
git add custom_variants.yaml config.yaml
git commit -m "Add organization-specific variants"
git push origin main
```

# Configuration Validation and Troubleshooting

## Validation Commands

### Comprehensive Configuration Checking

```bash
# Check all configuration files for syntax and consistency
zzcollab --config validate

# List effective configuration (merged from all sources)
zzcollab --config list

# Check specific configuration values
zzcollab --config get team-name
zzcollab --config get variants.analysis.enabled
zzcollab --config get build.docker.platform
```

### Variant Definition Validation

```bash
# Validate profiles.yaml syntax
./add_profile.sh --validate

# Check for missing or invalid profile references
zzcollab --variants-config config.yaml --dry-run

# Test profile definitions without building
./add_profile.sh --test-definitions
```

### Docker and Build Validation

```bash
# Check Docker daemon and permissions
docker info

# Verify platform compatibility
docker buildx ls

# Test Docker build with specific variant
zzcollab --variants-config config.yaml --build-only minimal
```

## Common Configuration Issues

### Missing Dependencies

**Issue**: `yq` command not found
```bash
# Error: YAML configuration requires yq but it is not installed
Error: Configuration validation failed - yq command not found
```

**Solution**: Install yq YAML processor
```bash
# macOS
brew install yq

# Ubuntu/Debian
snap install yq
# or
wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O /usr/bin/yq
chmod +x /usr/bin/yq

# Verify installation
yq --version
```

### Docker Platform Issues

**Issue**: ARM64/AMD64 compatibility problems
```bash
# Error building profile 'geospatial': platform not supported
Error: rocker/geospatial:latest: no matching manifest for linux/arm64/v8
```

**Solution**: Configure platform compatibility
```yaml
# In config.yaml
build:
  docker:
    platform: "linux/amd64"  # Force AMD64 for compatibility
```

Or use ARM64-compatible profiles:
```yaml
profiles:
  analysis:
    enabled: true     # ARM64 compatible
  geospatial:
    enabled: false    # AMD64 only - disable on ARM64 systems
  alpine_analysis:
    enabled: true     # ARM64 compatible alternative
```

### Package Installation Failures

**Issue**: Custom packages fail to install
```bash
# Error during Docker build: package 'obscure_package' not available
Error: installation of package 'obscure_package' had non-zero exit status
```

**Solution**: Verify package availability and dependencies
```yaml
# Separate core packages from experimental ones
build_modes:
  safe_custom:
    docker_packages:
      - "renv"
      - "tidyverse"  # Known stable packages
    renv_packages:
      - "renv"
      - "tidyverse"
      - "experimental_package"  # Let renv handle experimental packages
```

### Permission and Access Issues

**Issue**: Docker daemon permission denied
```bash
# Error: permission denied while trying to connect to Docker daemon
Error: Got permission denied while trying to connect to the Docker daemon socket
```

**Solution**: Configure Docker access
```bash
# Add user to docker group (Linux)
sudo usermod -aG docker $USER
newgrp docker

# Restart Docker daemon (if needed)
sudo systemctl restart docker

# Verify access
docker run hello-world
```

### Configuration Hierarchy Conflicts

**Issue**: Settings not taking effect as expected
```bash
# User sets build_mode = "fast" but projects use "comprehensive"
# Project config overriding user config unexpectedly
```

**Solution**: Understand and verify hierarchy
```bash
# Check configuration sources and precedence
zzcollab --config list --verbose

# Shows which file each setting comes from:
# team_name: "myteam" (from ~/.zzcollab/config.yaml)
# build_mode: "comprehensive" (from ./zzcollab.yaml) [OVERRIDING user config]
```

Edit the appropriate configuration file:
```bash
# To use user default, remove from project config
vim ./zzcollab.yaml  # Remove build_mode setting

# To set project-specific override, ensure it is intentional
echo "# Project uses comprehensive mode instead of user default" >> ./zzcollab.yaml
```

# R Interface Configuration Management

ZZCOLLAB provides a complete R interface for configuration management, allowing you to work entirely within R/RStudio environments.

## Configuration Functions

### Basic Configuration Management

```{r config-basic, eval=FALSE}
library(zzcollab)

# Initialize configuration
init_config()

# Set configuration values
set_config("team_name", "datasci-lab")
set_config("build_mode", "standard")
set_config("dotfiles_dir", "~/dotfiles")

# Get configuration values
team <- get_config("team_name")
mode <- get_config("build_mode")

# List all configuration
config_list <- list_config()
print(config_list)

# Validate configuration
validation_result <- validate_config()
if (!validation_result$valid) {
  message("Configuration issues found:")
  print(validation_result$errors)
}
```

### Advanced Configuration with Custom Variants

```{r config-advanced, eval=FALSE}
# Set custom build mode with specific packages
set_config("build_mode", "my_analysis")

# This would correspond to a build_modes section in your YAML:
# build_modes:
#   my_analysis:
#     description: "Custom analysis environment"
#     docker_packages: ["renv", "tidyverse", "targets"]
#     renv_packages: ["renv", "tidyverse", "targets", "pins", "vetiver"]

# Create project with custom configuration
init_project(
  team_name = "datasci-lab",
  project_name = "customer-analysis",
  build_mode = "my_analysis",
  variants = c("minimal", "analysis", "alpine_minimal")
)
```

### Configuration-Aware Project Functions

```{r config-project, eval=FALSE}
# Functions automatically use configuration defaults
init_project("new-analysis")          # Uses configured team_name, build_mode
join_project("existing-project")      # Uses configured team_name and preferences

# Override specific settings while keeping others
init_project(
  project_name = "special-analysis",
  build_mode = "comprehensive"        # Override default build mode
  # team_name from config
)

# Explicit configuration for full control
init_project(
  team_name = "special-team",
  project_name = "collaborative-analysis",
  build_mode = "comprehensive",
  dotfiles_path = "~/special-dotfiles"
)
```

## Configuration Inspection and Debugging

### Understanding Effective Configuration

```{r config-debug, eval=FALSE}
# See the complete effective configuration
effective_config <- get_effective_config()
str(effective_config)

# Check configuration sources for specific values
config_sources <- get_config_sources()
print(config_sources$team_name)  # Shows which file provides team_name

# Validate configuration with detailed output
validation <- validate_config(verbose = TRUE)
if (validation$has_warnings) {
  message("Configuration warnings:")
  sapply(validation$warnings, message)
}
```

### Working with Multiple Configurations

```{r config-multiple, eval=FALSE}
# Save current configuration state
current_config <- save_config_state()

# Temporarily change configuration for specific project
temp_config <- list(
  team_name = "temporary-team",
  build_mode = "fast"
)
apply_temp_config(temp_config)

# Do work with temporary configuration
init_project("temp-project")

# Restore original configuration
restore_config_state(current_config)

# Verify restoration
get_config("team_name")  # Should be back to original value
```

# Best Practices and Recommendations

## Configuration Strategy by Use Case

### Solo Researcher
- **User config only**: Set personal defaults in `~/.zzcollab/config.yaml`
- **Minimal variants**: Use 2-3 profiles (minimal, analysis, alpine_minimal)
- **Standard build mode**: Balance between functionality and build time
- **Simple package lists**: Stick to well-established packages

```yaml
# ~/.zzcollab/config.yaml for solo researcher
defaults:
  team_name: "myresearch"
  build_mode: "standard"

# No custom build_modes - use built-in standard mode
```

### Small Research Team (2-5 people)
- **Project configs**: Share configuration via `./zzcollab.yaml` in repositories
- **Focused variants**: 3-5 variants covering team's research domains
- **Workflow alignment**: Team agrees on build mode and package needs
- **Package coordination**: Custom build modes for shared analysis workflows

```yaml
# ./zzcollab.yaml for small team
team:
  name: "psychlab"
  project: "attention-study"

profiles:
  minimal:
    enabled: true    # Quick testing
  analysis:
    enabled: true    # Primary analysis
  publishing:
    enabled: true    # Manuscript preparation

build_modes:
  psych_analysis:
    description: "Psychology research workflow"
    docker_packages: ["renv", "tidyverse", "here"]
    renv_packages: ["renv", "tidyverse", "psych", "lavaan", "sem", "papaja"]
```

### Large Research Organization (10+ people)
- **System configs**: Organization defaults in `/etc/zzcollab/config.yaml`
- **Extensive variants**: Full profile library available to teams
- **Complete research lifecycle**: All workflows supported (data analysis, manuscripts, packages)
- **Custom profile library**: Organization-specific variants in custom libraries

```yaml
# /etc/zzcollab/config.yaml for organization
defaults:
  github_account: "university-research"

# Custom organization variants
build:
  variant_library: "/etc/zzcollab/org_variants.yaml"

collaboration:
  github:
    default_visibility: "private"
    enable_actions: true

  documentation:
    auto_generate_readme: true
    contributing_guide: true
```

## Package Management Best Practices

### Docker vs renv Package Separation

**Docker Packages** (installed during image build):
- System-wide development tools: `renv`, `devtools`, `here`, `conflicted`
- Essential utilities everyone needs: `usethis`, `testthat`, `knitr`
- Large, stable dependencies: `tidyverse` (if used by most team members)

**renv Packages** (project-specific):
- Analysis-specific packages: domain-specific statistical packages
- Experimental or cutting-edge packages: newly released packages
- Version-sensitive packages: packages requiring specific versions
- Data-specific packages: packages for particular datasets or APIs

```yaml
# Good separation example
build_modes:
  good_separation:
    docker_packages:
      - "renv"          # Package management (everyone needs)
      - "devtools"      # Development tools (everyone needs)
      - "here"          # Path management (everyone needs)
      - "conflicted"    # Namespace management (everyone needs)
    renv_packages:
      - "renv"
      - "tidyverse"     # Analysis packages (project-specific)
      - "targets"       # Workflow management (project-specific)
      - "specific_analysis_package"  # Domain-specific (project-specific)
```

### Version Management Strategy

```yaml
# Pin critical package versions in project configs
build_modes:
  stable_analysis:
    description: "Stable versions for reproducible analysis"
    docker_packages: ["renv", "devtools", "here"]
    renv_packages:
      - "renv"
      - "dplyr@1.1.0"        # Pin specific version
      - "ggplot2@3.4.0"      # Pin specific version
      - "latest_package"     # Use latest for new packages
```

## Performance Optimization

### Build Time Optimization

1. **Use appropriate build modes**: Fast mode for CI/CD, Comprehensive for production
2. **Minimize Docker packages**: Only install widely-used packages in Docker
3. **Layer caching**: Order packages by stability (stable packages first)
4. **Parallel builds**: Enable parallel profile building in configuration

```yaml
# Optimized for build performance
build:
  docker:
    parallel_builds: true
    memory_limit: "4g"

  packages:
    parallel_installs: true
```

### Container Size Optimization

1. **Choose appropriate base images**: Use minimal bases when possible
2. **Use Alpine variants**: For CI/CD and testing workflows
3. **Separate concerns**: Use different variants for different purposes

```yaml
# Size-optimized profile strategy
profiles:
  alpine_minimal:
    enabled: true     # ~200MB for CI/CD
  analysis:
    enabled: true     # ~1.2GB for development
  # Don't enable comprehensive variants unless needed
```

## Security and Access Management

### GitHub Repository Settings

```yaml
collaboration:
  github:
    default_visibility: "private"    # Default to private repositories
    branch_protection: true          # Require PR reviews

    repository:
      allow_merge_commits: false     # Require clean history
      allow_squash_merging: true     # Allow squash merging
      delete_head_branches: true     # Clean up after merging
```

### Container Security

```yaml
development:
  container:
    default_user: "analyst"          # Don't run as root
    read_only_volumes: true          # Mount shared volumes read-only when possible
```

### Access Control

- **User configs**: Personal settings only (team names, preferences)
- **Project configs**: Team settings (variants, collaboration rules)
- **System configs**: Organization policies (security, defaults)

This separation ensures that sensitive organization settings cannot be overridden by individual users or projects.

# Conclusion

ZZCOLLAB's configuration system provides powerful, flexible control over research environments while maintaining simplicity for common use cases. The multi-layered hierarchy allows individual preferences, team coordination, and organizational policies to coexist effectively.

Key takeaways:

1. **Start simple**: Use built-in build modes and standard variants for most projects
2. **Customize gradually**: Add custom profiles and packages as needs become clear
3. **Coordinate with teams**: Use project configs to ensure team consistency
4. **Optimize for workflow**: Choose variants and packages that match your research needs
5. **Validate regularly**: Use configuration validation to catch issues early

The configuration system scales from solo researchers to large organizations, providing reproducible, customizable research environments that eliminate configuration drift and enable effective collaboration.

For detailed technical documentation, see:
- `zzcollab --help` for command-line options
- `help(package = "zzcollab")` for R interface documentation
- `templates/profiles.yaml` for available profiles
- `docs/UNIFIED_PARADIGM_GUIDE.md` for research compendium guidance
