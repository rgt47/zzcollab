---
title: "Quick Start: 5-Minute Reproducible Analysis"
author: "ZZCOLLAB Development Team"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Quick Start: 5-Minute Reproducible Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

# Introduction

This quick start guide demonstrates how to create a fully reproducible analysis
with all 5 levels of reproducibility in under 10 minutes. You will create a
scatter plot analysis of Palmer Penguins bill measurements and push it to
GitHub as a private repository.

**What you will build:**
- Scatter plot: bill length vs bill depth
- Complete reproducibility: renv + Docker + Unit Testing + CI/CD
- Private GitHub repository with automated validation

**Prerequisites:**
- Docker installed and running
- GitHub account (example: rgt47)
- Personal access token for GitHub (with repo permissions)
- zzcollab installed (`./install.sh`)
- Dotfiles directory at `~/dotfiles` with files named without leading dots
  (e.g., `vimrc`, `tmux.conf`, `gitconfig`, `zshrc` not `.vimrc`, `.tmux.conf`, etc.)

**Important Note About Dotfiles:**

ZZCOLLAB expects dotfiles to be stored WITHOUT leading dots in your dotfiles
directory. This makes them easier to manage in version control and avoids
hidden file issues.

```bash
# Correct dotfiles structure
~/dotfiles/
  vimrc          # NOT .vimrc
  tmux.conf      # NOT .tmux.conf
  gitconfig      # NOT .gitconfig
  zshrc          # NOT .zshrc
```

When you use the `-D ~/dotfiles` flag, ZZCOLLAB automatically:
1. Copies files from `~/dotfiles/` to the project
2. Adds the leading dot when copying to Docker container
3. Result: `~/dotfiles/vimrc` becomes `~/.vimrc` in container

# Step-by-Step Instructions

## Step 1: Configure ZZCOLLAB (30 seconds)

Set your defaults once to eliminate repetitive typing for ALL future projects:

```bash
# Initialize configuration
zzcollab --config init

# Set team name (typically your GitHub username for solo projects)
zzcollab --config set team-name "rgt47"

# Set GitHub account
zzcollab --config set github-account "rgt47"

# Set default build mode (fast = 9 packages, ~2-3 min)
zzcollab --config set build-mode "fast"

# Set dotfiles directory
zzcollab --config set dotfiles-dir "~/dotfiles"

# Enable automatic GitHub repository creation
zzcollab --config set auto-github "true"
```

**What this accomplishes:**
- All future `zzcollab` commands use these defaults
- No need to specify `-t`, `-F`, `-D`, or `-G` flags repeatedly
- Change defaults anytime with `zzcollab --config set`

## Step 2: Create Complete Project (3-4 minutes)

Create a fully reproducible project in one command:

```bash
# Create complete project with Docker images, GitHub repo, and full structure
# All parameters come from Step 1 config (team-name, build-mode, dotfiles-dir, auto-github)
zzcollab -i -p penguin-bills

# Only flag needed:
# -i: Initialize complete project (team images + project structure + GitHub)
# -p: Project name (only thing that changes per project)
#
# These come from config (set in Step 1):
# -t rgt47: from team-name config
# -F: from build-mode config (fast)
# -D ~/dotfiles: from dotfiles-dir config
# -G: from auto-github config (true)
```

**What this does:**
1. Creates project directory `penguin-bills/`
2. Builds Docker team images with R + essential packages (9 packages, fast mode)
3. Pushes images to Docker Hub for team sharing
4. Creates complete project structure (R/, analysis/, tests/, .github/, etc.)
5. Creates GitHub repository automatically (public by default)
6. Sets up CI/CD workflows for automated testing
7. Initializes renv for dependency tracking

**Default Docker Profiles Created:**
- `minimal` profile: Essential development packages (~800MB)
- `analysis` profile: Tidyverse + data analysis tools (~1.2GB)

**Alternative: Interactive Profile Selection**

If you want to customize which Docker profiles to build (bioinformatics,
geospatial, Alpine, etc.), use the interactive approach:

```bash
# Create project directory first
mkdir penguin-bills && cd penguin-bills

# Initialize with interactive profile selection
zzcollab -i -p penguin-bills

# Browse and select from 14+ specialized profiles
./add_profile.sh

# Then complete setup
zzcollab -p penguin-bills
```

## Step 3: Set Repository to Private (30 seconds)

```bash
# Navigate to project directory (if not already there)
cd penguin-bills

# Make repository private using GitHub CLI
gh repo edit --visibility private
```

## Step 4: Create Analysis Functions and Report (3 minutes)

Start the Docker development environment:

```bash
# Enter Docker container
make docker-zsh
```

### Create Reusable Function (rrtools approach)

Following rrtools philosophy, create reusable functions in R/ directory first:

```bash
# Create function file
vim R/bill_analysis.R
```

Add this content to `R/bill_analysis.R`:

```r
#' Create scatter plot of bill dimensions
#'
#' @param data Palmer penguins data
#' @return ggplot object
#' @export
create_bill_plot <- function(data = palmerpenguins::penguins) {
  data %>%
    dplyr::filter(!is.na(bill_length_mm), !is.na(bill_depth_mm)) %>%
    ggplot2::ggplot(ggplot2::aes(x = bill_length_mm, y = bill_depth_mm,
                                  color = species)) +
    ggplot2::geom_point(size = 3, alpha = 0.7) +
    ggplot2::labs(
      title = 'Palmer Penguins: Bill Dimensions',
      x = 'Bill Length (mm)',
      y = 'Bill Depth (mm)',
      color = 'Species'
    ) +
    ggplot2::theme_minimal()
}
```

### Create Analysis Report

Now create the report that sources the function:

```bash
# Create the report file
vim analysis/report/report.Rmd
```

Add this content to `analysis/report/report.Rmd`:

````
---
title: "Palmer Penguins Bill Dimensions Analysis"
author: "Reproducible Research Team"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Introduction

Analysis of bill length and bill depth measurements across three penguin species
from the Palmer Station Antarctica LTER.

## Data Loading

```{r load-data}
library(palmerpenguins)
library(ggplot2)
library(dplyr)

# Source analysis functions from R/
source("../../R/bill_analysis.R")

# Preview data
head(penguins)
```

## Analysis

### Bill Dimensions by Species

```{r bill-plot, fig.width=8, fig.height=6}
# Generate plot using function from R/
plot <- create_bill_plot()
print(plot)

# Save plot
ggsave("../figures/bill_scatter.png", plot, width = 8, height = 6)
```

## Summary

The analysis reveals distinct bill dimension patterns across penguin species.
````

### Install Packages and Render

Then install packages and render the report:

```bash
# Install required packages
Rscript -e 'renv::install("palmerpenguins")'
Rscript -e 'renv::install("ggplot2")'
Rscript -e 'renv::install("dplyr")'

# Render the report
Rscript -e 'rmarkdown::render("analysis/report/report.Rmd")'

# Save dependencies
Rscript -e 'renv::snapshot()'
```

## Step 5: Add Unit Tests - Level 4 (2 minutes)

Still inside the Docker container (from `make docker-zsh`), add tests for the function in R/:

```bash
# Initialize testing infrastructure
Rscript -e 'usethis::use_testthat()'

# Create test file
vim tests/testthat/test-bill_analysis.R
```

Add this content to `tests/testthat/test-bill_analysis.R`:

```r
# Source function from R/
source('../../R/bill_analysis.R')

test_that('create_bill_plot produces valid ggplot', {
  plot <- create_bill_plot()

  # Valid ggplot object
  expect_s3_class(plot, 'ggplot')

  # Correct title
  expect_equal(plot$labels$title, 'Palmer Penguins: Bill Dimensions')
})

test_that('create_bill_plot handles missing data', {
  # Data with missing values
  test_data <- palmerpenguins::penguins
  test_data$bill_length_mm[1:5] <- NA

  plot <- create_bill_plot(test_data)

  # Should still produce plot
  expect_s3_class(plot, 'ggplot')
})

test_that('create_bill_plot includes all species', {
  plot <- create_bill_plot()

  # Should have species in color aesthetic
  expect_true('species' %in% names(plot$labels))
})
```

Then run the tests:

```bash
# Run tests
Rscript -e 'devtools::test()'
```

## Step 6: Validate and Commit (1 minute)

Exit the container and validate everything works in a clean environment:

```bash
# Exit the Docker container (if still inside from Step 5)
exit

# Run tests in clean environment
make docker-test

# Validate dependencies
Rscript validate_package_environment.R --quiet --fail-on-issues
```

Now commit your work:

```bash
git add .
git commit -m "$(cat <<'EOF'
Add bill dimensions scatter plot analysis

Analysis:
- Scatter plot of bill length vs bill depth by species
- Palmer Penguins dataset
- Function-based implementation with unit tests

Reproducibility:
- Level 2: renv dependency tracking
- Level 3: Docker environment isolation
- Level 4: Unit tests for computational correctness
- Level 5: CI/CD automated validation

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"

git push
```

## Step 7: Verify CI/CD (30 seconds)

Check that automated validation runs:

```bash
# View CI/CD status
gh run list --limit 3

# Or view in browser
gh repo view --web
```

GitHub Actions will automatically:
1. Build Docker container from scratch
2. Validate package dependencies
3. Run unit tests
4. Report results

## Step 8: Configure Report Rendering CI/CD (Optional, 2 minutes)

If you want GitHub Actions to automatically render your report on every push,
update the workflow to point to your report file:

```bash
# Edit the render-paper workflow
vim .github/workflows/render-paper.yml
```

Change line 46 from:
```yaml
compendium-env Rscript -e 'rmarkdown::render("analysis/paper/paper.Rmd")'
```

To:
```yaml
compendium-env Rscript -e 'rmarkdown::render("analysis/report/report.Rmd")'
```

Then commit and push:
```bash
git add .github/workflows/render-paper.yml
git commit -m "Update CI/CD to render analysis/report/report.Rmd"
git push
```

**What this enables:**
- Automatic report rendering on every push to main
- Fresh computational environment for each render
- Downloadable PDF/HTML artifacts
- Verification that analysis is fully reproducible

# What You Built

## All 5 Reproducibility Levels

**Level 1**: Basic R Project âœ— (skipped for reproducibility)

**Level 2**: renv âœ“
- `renv.lock` records exact package versions
- `renv::snapshot()` captured dependencies

**Level 3**: Docker âœ“
- Dockerfile specifies complete environment
- Anyone can reproduce with `make docker-zsh`

**Level 4**: Unit Testing âœ“
- Tests validate plot creation
- Tests verify missing data handling
- Tests confirm species included

**Level 5**: CI/CD âœ“
- GitHub Actions runs on every push
- Automated test suite execution
- Dependency validation

## Project Structure

```
penguin-bills/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ r-package.yml        # Automated CI/CD validation
â”œâ”€â”€ R/
â”‚   â””â”€â”€ bill_analysis.R          # Tested function
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ report/
â”‚   â”‚   â”œâ”€â”€ report.Rmd           # Analysis report (reproducible)
â”‚   â”‚   â””â”€â”€ report.html          # Rendered output
â”‚   â”œâ”€â”€ figures/
â”‚   â”‚   â””â”€â”€ bill_scatter.png     # Generated plot
â”‚   â””â”€â”€ tables/                  # Generated tables
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw_data/                # Original, unmodified data
â”‚   â”œâ”€â”€ derived_data/            # Processed analysis-ready data
â”‚   â”œâ”€â”€ metadata/                # Data documentation
â”‚   â””â”€â”€ README.md                # Data dictionary and documentation
â”œâ”€â”€ scripts/                     # Working scripts and exploration
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-bill_analysis.R # Unit tests
â”œâ”€â”€ man/                         # Generated function documentation
â”œâ”€â”€ vignettes/                   # Package tutorials
â”œâ”€â”€ docs/                        # Project documentation
â”œâ”€â”€ renv/                        # renv package cache
â”œâ”€â”€ .Rbuildignore                # Files excluded from package build
â”œâ”€â”€ .gitignore                   # Git exclusions
â”œâ”€â”€ DESCRIPTION                  # Project metadata and dependencies
â”œâ”€â”€ NAMESPACE                    # Function exports (managed by roxygen2)
â”œâ”€â”€ LICENSE                      # GPL-3 license
â”œâ”€â”€ Makefile                     # Development workflow automation
â”œâ”€â”€ Dockerfile                   # Environment specification
â”œâ”€â”€ renv.lock                    # Exact package versions
â””â”€â”€ penguin-bills.Rproj          # RStudio project file
```

## Verification Checklist

- âœ“ Docker images built and pushed
- âœ“ GitHub repository created (private)
- âœ“ Analysis produces scatter plot
- âœ“ Unit tests pass locally
- âœ“ Dependencies captured in renv.lock
- âœ“ CI/CD validates on every push
- âœ“ Complete reproducibility achieved

# Next Steps

## Extend Your Analysis

```{r eval=FALSE}
# Add more plots
create_flipper_plot <- function(data = penguins) {
  # Flipper length vs body mass
}

# Add statistical analysis
fit_bill_model <- function(data) {
  lm(bill_depth_mm ~ bill_length_mm * species, data = data)
}

# Write more tests
test_that("model includes species interaction", {
  model <- fit_bill_model(penguins)
  expect_true("bill_length_mm:species" %in% names(coef(model)))
})
```

## Collaborate

Share your private repository:

```bash
# Add collaborator
gh repo edit --add-collaborator username

# Team member joins (uses same team images from Docker Hub)
git clone https://github.com/rgt47/penguin-bills.git
cd penguin-bills

# Team member pulls your Docker images and sets up project
zzcollab -t rgt47 -p penguin-bills -I shell

# Enter identical development environment
make docker-zsh
```

## Publish Results

```bash
# Create manuscript
mkdir -p analysis/paper
# Add paper.Rmd with analysis

# Render paper automatically via CI/CD
# (already configured in .github/workflows/render-paper.yml)
```

# Troubleshooting

## GitHub Repository Creation Fails

```bash
# If auto-github fails, create repository manually
cd penguin-bills
gh repo create rgt47/penguin-bills --private --source=. --remote=origin --push

# Or disable auto-github in config and create later
zzcollab --config set auto-github "false"
zzcollab -i -p penguin-bills  # Complete setup without GitHub
gh repo create rgt47/penguin-bills --private --source=. --remote=origin --push
```

## Docker Build Errors

```bash
# Check Docker daemon running
docker info

# Clean rebuild (uses config defaults)
docker system prune
rm -rf penguin-bills  # Remove failed directory
zzcollab -i -p penguin-bills  # Uses config: team-name, build-mode, dotfiles-dir, auto-github
```

## Test Failures

```bash
# Run tests with verbose output
make docker-zsh
R
devtools::test()  # See detailed failure messages

# Check test coverage
covr::package_coverage()
```

## CI/CD Failures

```bash
# View workflow logs
gh run view --log

# Validate locally first
Rscript validate_package_environment.R --quiet --fail-on-issues
make docker-test
```

# Customizing Docker Profiles

## View Available Profiles

```bash
# Browse 14+ specialized profiles interactively
cd penguin-bills
./add_profile.sh

# Available categories:
# - Standard Research: minimal, analysis, modeling, publishing
# - Specialized Domains: bioinformatics, geospatial
# - Lightweight Alpine: alpine_minimal, alpine_analysis, hpc_alpine
# - R-Hub Testing: rhub_ubuntu, rhub_fedora, rhub_windows
```

## Add Specialized Profile

```bash
# Example: Add bioinformatics profile for genomics work
./add_profile.sh
# Select "bioinformatics" from menu

# Edit config.yaml to enable it
vim config.yaml
# Set enabled: true for bioinformatics profile

# Rebuild team images with new profile
zzcollab --profiles-config config.yaml
```

## Profile vs Build Mode

**Docker Profiles** (minimal, analysis, modeling, etc.):
- Control which **Docker base image** and **pre-installed packages** the team uses
- Shared by entire team via Docker Hub
- Examples: bioinformatics (Bioconductor), geospatial (sf/terra), alpine_minimal (CI/CD)

**Build Modes** (fast, standard, comprehensive):
- Control which **packages** are installed in your local renv
- Personal choice per developer
- Examples: fast (9 packages), standard (17 packages), comprehensive (47 packages)

# Time Breakdown

- **Step 1** (Configuration): 30 seconds
- **Step 2** (Complete project creation): 3-4 minutes
- **Step 3** (Make private): 30 seconds
- **Step 4** (Analysis Rmd report): 3 minutes
- **Step 5** (Unit tests): 2 minutes
- **Step 6** (Validate & commit): 1 minute
- **Step 7** (Verify CI/CD): 30 seconds
- **Step 8** (Configure report rendering): 2 minutes (optional)

**Total**: ~10-12 minutes for complete 5-level reproducible analysis
(~14 minutes with optional Step 8)

# Summary

You created a fully reproducible analysis with:

- **Environment consistency**: Docker ensures identical R, packages, system libraries
- **Computational correctness**: Unit tests validate analytical logic
- **Automated verification**: CI/CD catches errors on every commit
- **Private collaboration**: GitHub private repo ready for team members
- **Professional workflow**: Industry-standard practices for research software

This is the gold standard for reproducible computational research. All 5 levels
working together ensure your analysis is not only reproducible, but also
correct and maintainable.

For more details on each level, see `vignette("reproducibility-layers")`.
