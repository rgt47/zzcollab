---
title: "Quick Start: 5-Minute Reproducible Analysis"
author: "ZZCOLLAB Development Team"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Quick Start: 5-Minute Reproducible Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

# Introduction

This quick start guide demonstrates how to create a fully reproducible analysis
with all 5 levels of reproducibility in under 10 minutes. You will create a
scatter plot analysis of Palmer Penguins bill measurements and push it to
GitHub as a private repository.

**What you will build:**
- Scatter plot: bill length vs bill depth
- Complete reproducibility: renv + Docker + Unit Testing + CI/CD
- Private GitHub repository with automated validation

**Prerequisites:**
- Docker installed and running
- GitHub account (example: rgt47)
- Personal access token for GitHub (with repo permissions)
- zzcollab installed (`./install.sh`)
- Dotfiles directory at `~/dotfiles` with files named without leading dots
  (e.g., `vimrc`, `tmux.conf`, `gitconfig`, `zshrc` not `.vimrc`, `.tmux.conf`, etc.)

**Important Note About Dotfiles:**

ZZCOLLAB expects dotfiles to be stored WITHOUT leading dots in your dotfiles
directory. This makes them easier to manage in version control and avoids
hidden file issues.

```bash
# Correct dotfiles structure
~/dotfiles/
  vimrc          # NOT .vimrc
  tmux.conf      # NOT .tmux.conf
  gitconfig      # NOT .gitconfig
  zshrc          # NOT .zshrc
```

When you use the `-D ~/dotfiles` flag, ZZCOLLAB automatically:
1. Copies files from `~/dotfiles/` to the project
2. Adds the leading dot when copying to Docker container
3. Result: `~/dotfiles/vimrc` becomes `~/.vimrc` in container

# Step-by-Step Instructions

## Step 1: Configure ZZCOLLAB (30 seconds)

Set your defaults once to eliminate repetitive typing for ALL future projects:

```bash
# Initialize configuration
zzcollab --config init

# Set team name (typically your GitHub username for solo projects)
zzcollab --config set team-name "rgt47"

# Set GitHub account
zzcollab --config set github-account "rgt47"

# Set default renv mode (fast = 9 packages, ~2-3 min)
zzcollab --config set renv-mode "fast"

# Set default Docker profile (optional - leave empty for standard)
zzcollab --config set profile-name ""

# Set dotfiles directory
zzcollab --config set dotfiles-dir "~/dotfiles"

# Enable automatic GitHub repository creation
zzcollab --config set auto-github "true"
```

**What this accomplishes:**
- All future `zzcollab` commands use these defaults
- No need to specify `-t`, `-F`, `-D`, or `-G` flags repeatedly
- Change defaults anytime with `zzcollab --config set`

**Configuration Options Explained:**

- **renv-mode**: Controls R packages in renv.lock (personal choice)
  - Options: minimal, fast, standard, comprehensive
  - Independent of Docker environment

- **profile-name**: Controls Docker environment (team/shared)
  - Options: minimal, rstudio, analysis, bioinformatics, geospatial, etc.
  - Leave empty for standard rocker/r-ver base
  - Can also set libs-bundle and pkgs-bundle for custom composition

## Step 2: Create Project (3-4 minutes)

Create your reproducible analysis project with a single command:

```bash
# Create project (all parameters from Step 1 config)
mkdir penguin-bills && cd penguin-bills && zzcollab

# Flags come from config (set in Step 1):
# -t rgt47: from team-name config
# -F: from renv-mode config (fast)
# -D ~/dotfiles: from dotfiles-dir config
# -G: from auto-github config (true)
```

**What this does:**
1. Creates complete project structure (R/, analysis/, tests/, .github/, etc.)
2. Builds Docker image with R + essential packages
3. Creates GitHub repository automatically (if auto-github enabled)
4. Sets up CI/CD workflows for automated testing
5. Initializes renv for dependency tracking

**Solo Developer Simplification:**

Since you are working solo (not initializing a team), zzcollab creates a
streamlined development environment optimized for individual work.

**Using Different Docker Profiles:**

If you want a specialized Docker environment (bioinformatics, geospatial, etc.),
use the `--profile-name` flag or set it in config:

```bash
# Option 1: Set profile in config (applies to all future projects)
zzcollab --config set profile-name "bioinformatics"
mkdir genomics-study && cd genomics-study && zzcollab

# Option 2: Use flag for one-time profile selection
mkdir spatial-analysis && cd spatial-analysis
zzcollab --profile-name geospatial

# Option 3: Custom composition with bundles
mkdir custom-project && cd custom-project
zzcollab -b rocker/r-ver --libs geospatial --pkgs modeling

# Browse all available profiles
zzcollab --list-profiles
zzcollab --list-libs      # System library bundles
zzcollab --list-pkgs      # R package bundles
```

**Profile vs Renv Mode:**

- **Docker Profile** (`--profile-name`): Changes the base Docker image and pre-installed packages
  - Shared across team members
  - Examples: bioinformatics, geospatial, alpine_minimal
  - Set once in config or specify per project

- **Renv Mode** (`-M/-F/-S/-C`): Controls packages installed in renv.lock
  - Personal choice, independent of Docker
  - Examples: minimal (3 packages), fast (9 packages), standard (17 packages)
  - Can use fast renv mode with bioinformatics Docker profile

## Step 3: Set Repository to Private (30 seconds)

```bash
# Already in penguin-bills/ directory from Step 2b
# Make repository private using GitHub CLI
gh repo edit --visibility private
```

## Step 4: Create Analysis Functions and Report (3 minutes)

Start the Docker development environment (builds personal image from team image):

```bash
# Enter Docker container
make docker-zsh
```

### Create Reusable Function (rrtools approach)

Following rrtools philosophy, create reusable functions in R/ directory first:

```bash
# Create function file
vim R/bill_analysis.R
```

Add this content to `R/bill_analysis.R`:

```r
#' Create scatter plot of bill dimensions
#'
#' @param data Palmer penguins data
#' @return ggplot object
#' @export
create_bill_plot <- function(data = palmerpenguins::penguins) {
  data %>%
    dplyr::filter(!is.na(bill_length_mm), !is.na(bill_depth_mm)) %>%
    ggplot2::ggplot(ggplot2::aes(x = bill_length_mm, y = bill_depth_mm,
                                  color = species)) +
    ggplot2::geom_point(size = 3, alpha = 0.7) +
    ggplot2::labs(
      title = 'Palmer Penguins: Bill Dimensions',
      x = 'Bill Length (mm)',
      y = 'Bill Depth (mm)',
      color = 'Species'
    ) +
    ggplot2::theme_minimal()
}
```

### Create Analysis Report

Now create the report that sources the function:

```bash
# Create the report file
vim analysis/report/report.Rmd
```

Add this content to `analysis/report/report.Rmd`:

````
---
title: "Palmer Penguins Bill Dimensions Analysis"
author: "Reproducible Research Team"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Introduction

Analysis of bill length and bill depth measurements across three penguin species
from the Palmer Station Antarctica LTER.

## Data Loading

```{r load-data}
library(palmerpenguins)
library(ggplot2)
library(dplyr)

# Source analysis functions from R/
source("../../R/bill_analysis.R")

# Preview data
head(penguins)
```

## Analysis

### Bill Dimensions by Species

```{r bill-plot, fig.width=8, fig.height=6}
# Generate plot using function from R/
plot <- create_bill_plot()
print(plot)

# Save plot
ggsave("../figures/bill_scatter.png", plot, width = 8, height = 6)
```

## Summary

The analysis reveals distinct bill dimension patterns across penguin species.
````

### Install Packages and Render

Then install packages and render the report:

```bash
# Install required packages
Rscript -e 'renv::install("palmerpenguins")'
Rscript -e 'renv::install("ggplot2")'
Rscript -e 'renv::install("dplyr")'

# Render the report
Rscript -e 'rmarkdown::render("analysis/report/report.Rmd")'

# Save dependencies
Rscript -e 'renv::snapshot()'
```

## Step 5: Add Unit Tests - Level 4 (2 minutes)

Still inside the Docker container (from `make docker-zsh`), add tests for the function in R/:

```bash
# Initialize testing infrastructure
Rscript -e 'usethis::use_testthat()'

# Create test file
vim tests/testthat/test-bill_analysis.R
```

Add this content to `tests/testthat/test-bill_analysis.R`:

```r
# Source function from R/
source('../../R/bill_analysis.R')

test_that('create_bill_plot produces valid ggplot', {
  plot <- create_bill_plot()

  # Valid ggplot object
  expect_s3_class(plot, 'ggplot')

  # Correct title
  expect_equal(plot$labels$title, 'Palmer Penguins: Bill Dimensions')
})

test_that('create_bill_plot handles missing data', {
  # Data with missing values
  test_data <- palmerpenguins::penguins
  test_data$bill_length_mm[1:5] <- NA

  plot <- create_bill_plot(test_data)

  # Should still produce plot
  expect_s3_class(plot, 'ggplot')
})

test_that('create_bill_plot includes all species', {
  plot <- create_bill_plot()

  # Should have species in color aesthetic
  expect_true('species' %in% names(plot$labels))
})
```

Then run the tests:

```bash
# Run tests
Rscript -e 'devtools::test()'
```

## Step 6: Validate and Commit (1 minute)

Exit the container and validate everything works in a clean environment:

```bash
# Exit the Docker container (if still inside from Step 5)
exit

# Run tests in clean environment
make docker-test

# Validate dependencies
Rscript validate_package_environment.R --quiet --fail-on-issues
```

Now commit your work:

```bash
git add .
git commit -m "$(cat <<'EOF'
Add bill dimensions scatter plot analysis

Analysis:
- Scatter plot of bill length vs bill depth by species
- Palmer Penguins dataset
- Function-based implementation with unit tests

Reproducibility:
- Level 2: renv dependency tracking
- Level 3: Docker environment isolation
- Level 4: Unit tests for computational correctness
- Level 5: CI/CD automated validation

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"

git push
```

## Step 7: Verify CI/CD (30 seconds)

Check that automated validation runs:

```bash
# View CI/CD status
gh run list --limit 3

# Or view in browser
gh repo view --web
```

GitHub Actions will automatically:
1. Build Docker container from scratch
2. Validate package dependencies
3. Run unit tests
4. Report results

## Step 8: Configure Report Rendering CI/CD (Optional, 2 minutes)

If you want GitHub Actions to automatically render your report on every push,
update the workflow to point to your report file:

```bash
# Edit the render-paper workflow
vim .github/workflows/render-paper.yml
```

Change line 46 from:
```yaml
compendium-env Rscript -e 'rmarkdown::render("analysis/paper/paper.Rmd")'
```

To:
```yaml
compendium-env Rscript -e 'rmarkdown::render("analysis/report/report.Rmd")'
```

Then commit and push:
```bash
git add .github/workflows/render-paper.yml
git commit -m "Update CI/CD to render analysis/report/report.Rmd"
git push
```

**What this enables:**
- Automatic report rendering on every push to main
- Fresh computational environment for each render
- Downloadable PDF/HTML artifacts
- Verification that analysis is fully reproducible

# What You Built

## All 5 Reproducibility Levels

**Level 1**: Basic R Project âœ— (skipped for reproducibility)

**Level 2**: renv âœ“
- `renv.lock` records exact package versions
- `renv::snapshot()` captured dependencies

**Level 3**: Docker âœ“
- Dockerfile specifies complete environment
- Anyone can reproduce with `make docker-zsh`

**Level 4**: Unit Testing âœ“
- Tests validate plot creation
- Tests verify missing data handling
- Tests confirm species included

**Level 5**: CI/CD âœ“
- GitHub Actions runs on every push
- Automated test suite execution
- Dependency validation

## The Five Pillars of Reproducibility

Your analysis is now fully reproducible thanks to five essential components that represent the necessary and sufficient elements for complete reproducibility:

### 1. Dockerfile - Computational Environment
- **R version**: Specifies exact R version (4.4.0)
- **System dependencies**: All system libraries (libcurl, libssl, etc.)
- **Base image**: Foundation for consistent environment
- **Environment variables**: Locale and system settings

```dockerfile
FROM rocker/verse:4.4.0

# Set locale for reproducible sorting/formatting
ENV LANG=en_US.UTF-8
ENV LC_ALL=en_US.UTF-8

RUN apt-get update && apt-get install -y libcurl4-openssl-dev
```

### 2. renv.lock - Exact Package Versions
- **Every R package**: Exact version for all packages used
- **Complete dependency tree**: All package dependencies
- **Source repositories**: CRAN, Bioconductor, GitHub

```json
{
  "tidyverse": {
    "Version": "2.0.0",
    "Repository": "CRAN"
  }
}
```

### 3. .Rprofile - R Session Configuration
- **Critical R options**: Version controlled and copied into Docker
- **Monitored settings**: `stringsAsFactors`, `contrasts`, `na.action`, `digits`, `OutDec`
- **Automatic checking**: `check_rprofile_options.R` alerts on changes

```r
# .Rprofile (version controlled)
options(
  stringsAsFactors = FALSE,
  digits = 7,
  OutDec = "."
)

# Activate renv for package management
source("renv/activate.R")
```

**Important**: ZZCOLLAB monitors critical `.Rprofile` options that affect analysis behavior. The `check_rprofile_options.R` script runs in CI/CD to catch changes that could alter results.

### 4. Analysis Source Code - Computational Logic
- **Analysis scripts**: `analysis/scripts/01_analysis.R`
- **Reusable functions**: `R/bill_analysis.R`
- **Reports**: `analysis/report/report.Rmd`
- **Tests**: `tests/testthat/test-bill_analysis.R`
- **Random seeds**: Set explicitly in code for stochastic analyses

```r
# Example: Set seed for reproducible random processes
set.seed(42)
model <- randomForest(species ~ ., data = penguins)
```

### 5. Research Data - Empirical Foundation
- **Raw data**: `analysis/data/raw_data/` (original, unmodified files)
- **Derived data**: `analysis/data/derived_data/` (processed, analysis-ready)
- **Data documentation**: `data/README.md` (data dictionary, provenance, processing lineage)
- **Quality assurance**: Validation checks, known issues, outlier documentation

```
analysis/data/
â”œâ”€â”€ raw_data/
â”‚   â”œâ”€â”€ penguins_raw.csv      # Original data (read-only)
â”‚   â””â”€â”€ README.md             # Data provenance and collection methods
â””â”€â”€ derived_data/
    â”œâ”€â”€ penguins_clean.csv    # Processed data
    â””â”€â”€ README.md             # Processing steps and transformations
```

**Critical insight**: Without the original research data, perfect computational reproducibility is meaningless. The analysis code operates on data, and that data must be preserved, documented, and version-controlled alongside the computational environment.

### Why Environment Variables Matter

Environment variables affect computational results silently and are critical for reproducibility:

**Locale settings** (`LANG`, `LC_ALL`):
- Control string sorting order (e.g., "Ã…land" sorts differently in US vs Swedish locales)
- Affect number parsing (comma vs period as decimal separator)
- Impact factor level ordering in statistical models

**Timezone** (`TZ`):
- Affects date-time arithmetic and aggregation
- Eliminates daylight saving time complications
- Ensures consistent temporal analyses across team members

**Parallel processing** (`OMP_NUM_THREADS`):
- Controls thread count for deterministic computation
- Single-threaded (`=1`) ensures reproducible results
- Multi-threaded can produce different results each run due to floating-point order

```dockerfile
# Environment variables set in Dockerfile
ENV LANG=en_US.UTF-8        # Standardize locale
ENV LC_ALL=en_US.UTF-8      # Override all locale categories
ENV TZ=UTC                  # No daylight saving time
ENV OMP_NUM_THREADS=1       # Deterministic single-threaded execution
```

**Real-world impact**: Two researchers running identical code in different locales or timezones can produce different results without explicit environment variable specification.

### How They Work Together:

```bash
# Someone reproduces your analysis 5 years from now:
git clone https://github.com/rgt47/penguin-bills.git
cd penguin-bills

# 1. Dockerfile builds environment (R version + system deps)
docker build -t penguin-env .
docker run -it -v $(pwd):/project penguin-env

# 2. renv.lock installs exact package versions
renv::restore()

# 3. Source code runs the analysis
source("analysis/scripts/01_analysis.R")
rmarkdown::render("analysis/report/report.Rmd")

# Result: Identical output to your original analysis
```

**Key Insight**:
- **Dockerfile** = Environment foundation (R version, system libraries, environment variables)
- **renv.lock** = Exact packages (source of truth for R dependencies)
- **.Rprofile** = R session settings (critical options that affect behavior)
- **Source Code** = Analytical logic (what actually runs, including random seeds)
- **Research Data** = Empirical observations (what analyses operate on)

All five pillars are version controlled in Git, representing the necessary and sufficient components for complete reproducibility. Without any one pillar, independent reproduction of the analysis becomes impossible.

### Reproducibility Checklist

When preparing analysis for publication or sharing, verify all five pillars.

For comprehensive best practices, troubleshooting, and team collaboration
patterns, see **docs/REPRODUCIBILITY_BEST_PRACTICES.md**.

**Pillar 1 - Dockerfile**:
- âœ… R version explicitly specified
- âœ… System dependencies documented
- âœ… Environment variables set (LANG, LC_ALL, TZ, OMP_NUM_THREADS)

**Pillar 2 - renv.lock**:
- âœ… All packages from all contributors included
- âœ… Exact versions with repository sources
- âœ… Committed to version control

**Pillar 3 - .Rprofile**:
- âœ… Critical options version controlled
- âœ… Monitored by check_rprofile_options.R in CI/CD
- âœ… Copied into Docker container

**Pillar 4 - Source Code**:
- âœ… Random seeds explicit for all stochastic operations
- âœ… Analysis scripts, functions, tests all committed
- âœ… Clear computational workflow documented

**Pillar 5 - Research Data**:
- âœ… Raw data preserved (read-only, original files)
- âœ… Data documentation complete (data dictionary, provenance)
- âœ… Processing scripts link raw to derived data
- âœ… Data quality notes documented

## Project Structure

```
penguin-bills/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ r-package.yml        # Automated CI/CD validation
â”œâ”€â”€ R/
â”‚   â””â”€â”€ bill_analysis.R          # Tested function
â”œâ”€â”€ analysis/
â”‚   â”œâ”€â”€ report/
â”‚   â”‚   â”œâ”€â”€ report.Rmd           # Analysis report (reproducible)
â”‚   â”‚   â””â”€â”€ report.html          # Rendered output
â”‚   â”œâ”€â”€ figures/
â”‚   â”‚   â””â”€â”€ bill_scatter.png     # Generated plot
â”‚   â””â”€â”€ tables/                  # Generated tables
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw_data/                # Original, unmodified data
â”‚   â”œâ”€â”€ derived_data/            # Processed analysis-ready data
â”‚   â”œâ”€â”€ metadata/                # Data documentation
â”‚   â””â”€â”€ README.md                # Data dictionary and documentation
â”œâ”€â”€ scripts/                     # Working scripts and exploration
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ testthat/
â”‚       â””â”€â”€ test-bill_analysis.R # Unit tests
â”œâ”€â”€ man/                         # Generated function documentation
â”œâ”€â”€ vignettes/                   # Package tutorials
â”œâ”€â”€ docs/                        # Project documentation
â”œâ”€â”€ renv/                        # renv package cache
â”œâ”€â”€ .Rbuildignore                # Files excluded from package build
â”œâ”€â”€ .gitignore                   # Git exclusions
â”œâ”€â”€ DESCRIPTION                  # Project metadata and dependencies
â”œâ”€â”€ NAMESPACE                    # Function exports (managed by roxygen2)
â”œâ”€â”€ LICENSE                      # GPL-3 license
â”œâ”€â”€ Makefile                     # Development workflow automation
â”œâ”€â”€ Dockerfile                   # Environment specification
â”œâ”€â”€ renv.lock                    # Exact package versions
â””â”€â”€ penguin-bills.Rproj          # RStudio project file
```

## Verification Checklist

- âœ“ Docker images built and pushed
- âœ“ GitHub repository created (private)
- âœ“ Analysis produces scatter plot
- âœ“ Unit tests pass locally
- âœ“ Dependencies captured in renv.lock
- âœ“ CI/CD validates on every push
- âœ“ Complete reproducibility achieved

# Next Steps

## Extend Your Analysis

```{r eval=FALSE}
# Add more plots
create_flipper_plot <- function(data = penguins) {
  # Flipper length vs body mass
}

# Add statistical analysis
fit_bill_model <- function(data) {
  lm(bill_depth_mm ~ bill_length_mm * species, data = data)
}

# Write more tests
test_that("model includes species interaction", {
  model <- fit_bill_model(penguins)
  expect_true("bill_length_mm:species" %in% names(coef(model)))
})
```

## Collaborate

### Team Lead Workflow

Initialize a team project with the `-i` flag:

```bash
# Option 1: Set team config once
zzcollab --config set team-name "genomicslab"
zzcollab --config set profile-name "bioinformatics"
zzcollab --config set renv-mode "fast"

# Create team project using config
mkdir study && cd study
zzcollab -i -p study

# Option 2: Use explicit flags
mkdir team-genomics && cd team-genomics
zzcollab -i -t genomicslab -p study --profile-name bioinformatics -F

# Option 3: Custom composition
zzcollab -i -t genomicslab -p study -b bioconductor/bioconductor_docker --libs bioinfo --pkgs bioinfo

# Share with collaborators
gh repo edit --add-collaborator username
```

**What `-i` does for teams:**
1. Builds team Docker image with chosen profile and pushes to Docker Hub
2. Creates complete project structure
3. Team members can join using the shared team image

**Profile Selection for Teams:**
- Team lead chooses Docker profile (bioinformatics, geospatial, etc.)
- All team members get identical Docker environment
- Team members can choose their own renv mode (minimal, fast, standard, comprehensive)

### Team Member Workflow

Clone and join the team project:

```bash
# Clone the repository
git clone https://github.com/genomicslab/study.git
cd study

# Join team (uses existing team image from Docker Hub)
zzcollab -t genomicslab -p study

# Or choose your own renv mode
zzcollab -t genomicslab -p study -M  # Minimal renv (3 packages)
zzcollab -t genomicslab -p study -F  # Fast renv (9 packages)

# Enter identical development environment
make docker-zsh
```

**What happens for team members:**
1. Pulls team image `genomicslab/study_core:latest` from Docker Hub
2. Team image has the Docker profile chosen by team lead (e.g., bioinformatics)
3. Creates personal Dockerfile using team image as base
4. Builds personal development image (fast - layers on top of team image)
5. Initializes renv with mode you chose (minimal, fast, standard, or comprehensive)

**Environment Consistency:**
- **Docker environment**: Identical for all team members (from team image)
- **Renv packages**: Personal choice (each member can use different mode)

### Adding Packages to Team Environment

Team members can add additional R packages to their personal Docker layer:

```bash
# Add modeling packages on top of team image
zzcollab -t genomicslab -p study --pkgs modeling

# This installs modeling packages in your personal Docker layer
# Team image remains unchanged
```

**Team member restrictions:**
- âœ— Cannot change Docker profile (use `--profile-name`)
- âœ— Cannot change base image (use `-b`)
- âœ— Cannot add system libraries (use `--libs`)
- âœ“ Can add R packages to Docker (use `--pkgs`)
- âœ“ Can choose renv mode independently (use `-M/-F/-S/-C`)
- âœ“ Can add packages to renv.lock (use `renv::install()` in container)

## Publish Results

```bash
# Create manuscript
mkdir -p analysis/paper
# Add paper.Rmd with analysis

# Render paper automatically via CI/CD
# (already configured in .github/workflows/render-paper.yml)
```

# Troubleshooting

## GitHub Repository Creation Fails

```bash
# If auto-github fails, create repository manually
cd penguin-bills
gh repo create rgt47/penguin-bills --private --source=. --remote=origin --push

# Or disable auto-github in config and create later
zzcollab --config set auto-github "false"
zzcollab -i -p penguin-bills  # Complete setup without GitHub
gh repo create rgt47/penguin-bills --private --source=. --remote=origin --push
```

## Docker Build Errors

```bash
# Check Docker daemon running
docker info

# Clean rebuild (uses config defaults)
docker system prune
rm -rf penguin-bills  # Remove failed directory

# Retry two-step workflow
zzcollab -i -p penguin-bills -y  # Step 2a: Create team images
cd penguin-bills
zzcollab -y -G                    # Step 2b: Complete project setup
```

## Test Failures

```bash
# Run tests with verbose output
make docker-zsh
R
devtools::test()  # See detailed failure messages

# Check test coverage
covr::package_coverage()
```

## CI/CD Failures

```bash
# View workflow logs
gh run view --log

# Validate locally first
Rscript validate_package_environment.R --quiet --fail-on-issues
make docker-test
```

# Customizing Profiles

## View Available Profiles

```bash
# List all predefined profiles
zzcollab --list-profiles

# List available library bundles (system dependencies)
zzcollab --list-libs

# List available package bundles (R packages)
zzcollab --list-pkgs
```

**Available Profiles:**
- **minimal** - Essential development packages (~800MB)
- **rstudio** - RStudio Server environment (~1GB)
- **analysis** - Data analysis with tidyverse (~1.2GB)
- **modeling** - Machine learning environment (~1.5GB)
- **bioinformatics** - Bioconductor genomics (~2GB)
- **geospatial** - GDAL/PROJ mapping tools (~2.5GB)
- **publishing** - LaTeX/Quarto publishing (~3GB)
- **alpine_minimal** - Ultra-lightweight (~200MB)
- **alpine_analysis** - Lightweight tidyverse (~400MB)

## Using Profiles

```bash
# Method 1: Set in config (recommended for consistent work)
zzcollab --config set profile-name "bioinformatics"
mkdir my-project && cd my-project && zzcollab  # Uses bioinformatics profile

# Method 2: Use flag for one-time selection
zzcollab --profile-name geospatial

# Method 3: Compose custom profile with bundles
zzcollab -b rocker/r-ver --libs geospatial --pkgs geospatial

# Method 4: Mix and match components
zzcollab -b bioconductor/bioconductor_docker --libs bioinfo --pkgs modeling
```

## Profile System Components

The profile system has two independent layers:

### Docker Environment Layer (Team/Shared)

**Profiles** (`--profile-name`):
- Complete Docker environment shortcuts
- Combines base image + system libraries + R packages
- Examples: `bioinformatics`, `geospatial`, `alpine_minimal`
- Shared across all team members
- Set via: `zzcollab --config set profile-name bioinformatics`

**Library Bundles** (`--libs`):
- System dependencies (apt-get/apk packages)
- Examples: `minimal`, `geospatial`, `bioinfo`, `modeling`, `publishing`, `alpine`
- Required for R packages needing system libraries (GDAL, PROJ, etc.)
- Set via: `zzcollab --config set libs-bundle geospatial`

**Package Bundles** (`--pkgs`):
- Pre-installed R packages in Docker image
- Examples: `essential`, `tidyverse`, `modeling`, `bioinfo`, `geospatial`, `publishing`, `shiny`
- Baked into Docker image for fast container startup
- Set via: `zzcollab --config set pkgs-bundle modeling`

### Renv Package Layer (Personal)

**Renv Modes** (`-M`, `-F`, `-S`, `-C`):
- Controls packages in renv.lock file (not in Docker)
- Minimal (3 packages), fast (9 packages), standard (17 packages), comprehensive (47 packages)
- **Independent of Docker profile** - personal choice
- Set via: `zzcollab --config set renv-mode fast`

**Example Combining Both Layers:**
```bash
# Docker profile: bioinformatics (Bioconductor base + genomics packages)
# Renv mode: fast (only 9 essential packages in renv.lock)
zzcollab --config set profile-name "bioinformatics"
zzcollab --config set renv-mode "fast"
mkdir genomics-analysis && cd genomics-analysis && zzcollab
```

This gives you:
- Bioconductor Docker environment with genomics tools (shared with team)
- Fast renv setup with minimal packages (your personal preference)

# Time Breakdown

- **Step 1** (Configuration): 30 seconds
- **Step 2** (Create project): 3-4 minutes
- **Step 3** (Make private): 30 seconds
- **Step 4** (Analysis Rmd report): 3 minutes
- **Step 5** (Unit tests): 2 minutes
- **Step 6** (Validate & commit): 1 minute
- **Step 7** (Verify CI/CD): 30 seconds
- **Step 8** (Configure report rendering): 2 minutes (optional)

**Total**: ~10-12 minutes for complete 5-level reproducible analysis
(~14 minutes with optional Step 8)

**Team Member Time** (joining existing project): ~6-8 minutes
- Skips Step 1 (uses team config)
- Pulls pre-built team images (faster than building from scratch)
- Only needs Steps 2-8

# Summary

You created a fully reproducible analysis with:

- **Environment consistency**: Docker ensures identical R, packages, system libraries
- **Computational correctness**: Unit tests validate analytical logic
- **Automated verification**: CI/CD catches errors on every commit
- **Private collaboration**: GitHub private repo ready for team members
- **Professional workflow**: Industry-standard practices for research software

This is the gold standard for reproducible computational research. All 5 levels
working together ensure your analysis is not only reproducible, but also
correct and maintainable.

## Understanding the Two-Layer Architecture

ZZCOLLAB uses a two-layer package management system for maximum flexibility:

### Layer 1: Docker Environment (Team/Shared)
- **Controlled by**: `--profile-name`, `-b`, `--libs`, `--pkgs`
- **Purpose**: Pre-installed packages in Docker image
- **Shared**: All team members get identical Docker environment
- **Examples**: Bioinformatics profile, geospatial libraries, tidyverse packages
- **When to use**: For packages everyone on team needs

### Layer 2: Renv Packages (Personal)
- **Controlled by**: `-M/-F/-S/-C` flags or `renv::install()` in container
- **Purpose**: Personal package preferences in renv.lock
- **Personal**: Each team member chooses independently
- **Examples**: Minimal (3), fast (9), standard (17), comprehensive (47) packages
- **When to use**: For your personal development preference

### Practical Example

Team lead sets up bioinformatics environment:
```bash
zzcollab -i -t genomicslab -p study --profile-name bioinformatics
```

Team members join with personal renv choices:
```bash
# Alice uses minimal renv (fast startup)
zzcollab -t genomicslab -p study -M

# Bob uses comprehensive renv (all packages)
zzcollab -t genomicslab -p study -C
```

**Result**:
- Both get identical Bioconductor Docker environment (Layer 1)
- Each has different renv.lock packages (Layer 2)
- Both can collaborate seamlessly

### What Happens to Final renv.lock?

**Important**: When multiple team members work together, the final `renv.lock` file contains packages from ALL contributors:

```bash
# Alice adds modeling packages
renv::install("tidymodels")
renv::snapshot()

# VALIDATE before committing
Rscript validate_package_environment.R --fix --fail-on-issues
devtools::test()  # Ensure nothing broke
exit

git add renv.lock DESCRIPTION
git commit -m "Add modeling packages"
git push

# Bob adds geospatial packages
git pull  # Gets Alice's changes
make docker-zsh

# Inside container:
renv::install("sf")
renv::snapshot()  # renv.lock now has tidymodels + sf

# VALIDATE before committing
Rscript validate_package_environment.R --fix --fail-on-issues
devtools::test()
exit

git add renv.lock DESCRIPTION
git commit -m "Add geospatial packages"
git push

# Final renv.lock contains BOTH Alice's and Bob's packages
```

**For reproducibility, renv.lock is the source of truth, NOT the Docker image.**

When someone reproduces the analysis:
```bash
# Pulls repository with complete renv.lock
git clone https://github.com/genomicslab/study.git
cd study

# Uses team Docker image (has base bioinformatics packages)
zzcollab -t genomicslab -p study
make docker-zsh

# Restores ALL packages from renv.lock (Alice's + Bob's)
renv::restore()  # Installs tidymodels + sf + all other packages
```

**Key Insight**: The Docker image provides the foundation (system dependencies, R version, base packages for performance), but `renv.lock` ensures complete reproducibility by specifying exact versions of ALL packages needed for the analysis.

For more details on each level, see `vignette("reproducibility-layers")`.
