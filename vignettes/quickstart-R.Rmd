---
title: "Quick Start: R Interface for ZZCOLLAB"
author: "ZZCOLLAB Development Team"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Quick Start: R Interface for ZZCOLLAB}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

# Introduction

This guide demonstrates how to use ZZCOLLAB entirely through R functions, without touching the command line. All functionality available via the `zzcollab` shell script is also accessible through the R package interface.

**What you will learn:**
- Configure ZZCOLLAB from R/RStudio
- Create reproducible projects using R functions
- Manage Docker environments through R
- Work with team collaboration via R interface
- Integrate into R-based workflows

**Prerequisites:**
- ZZCOLLAB installed (`./install.sh`)
- Docker installed and running
- R and RStudio (optional but recommended)

# Configuration from R

## Initialize Configuration

Set up your personal ZZCOLLAB configuration without leaving R:

```{r}
library(zzcollab)

# Initialize configuration file
init_config()

# Set your defaults
set_config("team_name", "myteam")
set_config("github_account", "myusername")
set_config("dotfiles_dir", "~/dotfiles")
set_config("profile_name", "analysis")

# View current configuration
list_config()

# Get specific values
team <- get_config("team_name")
profile <- get_config("profile_name")

# Validate configuration
validate_config()
```

**What this accomplishes:**
- Creates `~/.zzcollab/config.yaml` with your defaults
- Eliminates repetitive typing for future projects
- Provides same functionality as `zzcollab --config` commands

## Configuration Management

```{r}
# Check if a value is set
team <- get_config("team_name")
if (is.null(team)) {
  message("Team name not configured")
  set_config("team_name", "myteam")
}

# Update existing configuration
set_config("profile_name", "bioinformatics")

# View all settings
config <- list_config()
print(config)

# Validate before important operations
if (validate_config()) {
  message("Configuration is valid")
} else {
  stop("Configuration has errors")
}
```

# Solo Developer Workflow

## Create New Project

Initialize a reproducible research project entirely from R:

```{r}
# Method 1: Use configuration defaults
library(zzcollab)

# Create project directory
dir.create("~/projects/penguin-analysis")
setwd("~/projects/penguin-analysis")

# Initialize project (uses config defaults)
setup_project()

# Method 2: Override specific settings
setup_project(
  dotfiles_path = "~/dotfiles",
  base_image = "rocker/rstudio"
)
```

**After initialization**, build the Docker environment:

```{r}
# Build Docker image
rebuild("docker-build")

# Check if build succeeded
if (rebuild("docker-build")) {
  message("Docker image built successfully")
} else {
  stop("Docker build failed")
}
```

## Development Workflow

```{r}
# Check Docker container status
container_info <- status()
print(container_info)

# Add R packages to project
library(zzcollab)
add_package("ggplot2")
add_package(c("dplyr", "tidyr", "readr"))

# Sync environment from renv.lock
sync_env()

# Validate reproducibility
if (validate_repro()) {
  message("Environment is reproducible")
} else {
  warning("Reproducibility issues detected")
}
```

## Execute Analysis

Run scripts and render reports from R:

```{r}
# Execute analysis script in container
run_script("analysis/scripts/01_data_prep.R")

# Render R Markdown report
render_report("analysis/paper/paper.Rmd")

# Check results
if (file.exists("analysis/paper/paper.html")) {
  message("Report rendered successfully")
  browseURL("analysis/paper/paper.html")
}
```

## Git Integration

Manage version control without leaving R:

```{r}
# Check git status
changes <- git_status()

# Create commit
git_commit("Add penguin analysis with unit tests")

# Create feature branch
create_branch("add-statistical-models")

# Push changes
git_push()

# Create pull request
create_pr(
  title = "Add statistical modeling",
  body = "Implements linear mixed models for penguin morphology"
)
```

# Team Collaboration

## Team Lead: Initialize Team Project

Create a team project with R interface:

```{r}
library(zzcollab)

# Set team configuration
set_config("team_name", "genomicslab")
set_config("profile_name", "bioinformatics")
set_config("github_account", "genomicslab")

# Navigate to project directory
dir.create("~/projects/cancer-study")
setwd("~/projects/cancer-study")

# Initialize team project
init_project(
  team_name = "genomicslab",
  project_name = "cancer-study",
  github_account = "genomicslab",
  dotfiles_path = "~/dotfiles"
)
```

**After initialization**, build and share the team image:

```{r}
# Build team Docker image
rebuild("docker-build")

# Push to Docker Hub (requires docker login)
rebuild("docker-push-team")

# Check team images
images <- team_images()
print(images)
```

**Commit and push project structure:**

```{r}
# Commit initial setup
git_commit("Initial project setup with bioinformatics profile")

# Push to GitHub
git_push()
```

## Team Member: Join Team Project

Join an existing project using R:

```{r}
library(zzcollab)

# Clone repository (can use system() or do outside R)
system("git clone https://github.com/genomicslab/cancer-study.git")
setwd("cancer-study")

# Join project using team image
join_project(
  team_name = "genomicslab",
  project_name = "cancer-study",
  dotfiles_path = "~/dotfiles"
)

# Verify team images available
images <- team_images()
print(images)

# Sync environment
sync_env()
```

**Start development:**

```{r}
# Check container status
status()

# Add packages as needed
add_package("tidymodels")

# Run tests
rebuild("docker-test")

# Commit changes
git_commit("Add tidymodels for modeling workflow")
git_push()
```

# Help System

## Access Help from R

Get comprehensive help without leaving R:

```{r}
# Main help
zzcollab_help()

# Topic-specific help
zzcollab_help("quickstart")
zzcollab_help("config")
zzcollab_help("workflow")
zzcollab_help("docker")
zzcollab_help("troubleshooting")

# Development workflow guidance
zzcollab_next_steps()
```

**Available help topics:**
- `"general"` - Main help with all options
- `"init"` - Team initialization
- `"quickstart"` - Quick start guide
- `"workflow"` - Daily development workflow
- `"config"` - Configuration system
- `"dotfiles"` - Dotfiles setup
- `"renv"` - Package management
- `"docker"` - Docker essentials
- `"cicd"` - CI/CD and GitHub Actions
- `"github"` - GitHub integration
- `"troubleshooting"` - Common issues

# Complete R Workflow Example

## Palmer Penguins Analysis (Entirely in R)

```{r}
library(zzcollab)

# 1. SETUP: Configure once
init_config()
set_config("team_name", "myname")
set_config("dotfiles_dir", "~/dotfiles")
set_config("profile_name", "analysis")

# 2. CREATE PROJECT
dir.create("~/projects/penguin-bills")
setwd("~/projects/penguin-bills")
setup_project()

# 3. BUILD DOCKER ENVIRONMENT
if (!rebuild("docker-build")) {
  stop("Docker build failed")
}

# 4. DEVELOP ANALYSIS (in RStudio)
# Create analysis files, write code, etc.
# See vignette("quickstart") for analysis details

# 5. ADD PACKAGES
add_package("palmerpenguins")
add_package("ggplot2")
add_package("dplyr")

# 6. RUN TESTS
rebuild("docker-test")

# 7. VALIDATE REPRODUCIBILITY
if (!validate_repro()) {
  stop("Reproducibility checks failed")
}

# 8. VERSION CONTROL
git_status()
git_commit("Add bill dimensions scatter plot analysis")
git_push()

# 9. CREATE PULL REQUEST
create_pr(
  title = "Add penguin analysis",
  body = "Complete reproducible analysis with tests and CI/CD"
)

# 10. CHECK CI/CD STATUS
system("gh run list --limit 3")
```

# Docker Management

## Check and Manage Containers

```{r}
# View running containers
containers <- status()
print(containers)

# Rebuild Docker image
rebuild()

# Rebuild with specific target
rebuild("docker-build")
rebuild("docker-test")
rebuild("docker-check")

# List team images
images <- team_images()
if (nrow(images) > 0) {
  print(images)

  # Filter by team
  my_images <- images[grepl("myteam", images$repository), ]
  print(my_images)
} else {
  message("No team images found")
}
```

# Package Management

## Dynamic Package Installation

```{r}
# Add single package
add_package("tidyverse")

# Add multiple packages
add_package(c("sf", "terra", "mapview"))

# Add without auto-snapshot (manual control)
add_package("ggplot2", update_snapshot = FALSE)

# Sync from renv.lock (e.g., after git pull)
sync_env()

# Validate package consistency
rebuild("docker-check-renv")
```

**Alternative: Direct Installation**

You can also use standard R commands inside containers:

```{r, eval=FALSE}
# Inside container (make docker-zsh or make docker-rstudio)
install.packages("tidyverse")
# For GitHub packages:
install.packages("remotes")
remotes::install_github("user/package")
# Exit container - packages automatically captured in renv.lock
```

**Note**: ZZCOLLAB features auto-snapshot on container exit, so manual `renv::snapshot()` is typically unnecessary. Both `add_package()` (R function) and `install.packages()` (standard R) work identically - packages are captured automatically when you exit containers.

# RStudio Integration

## Working in RStudio

All R functions work seamlessly in RStudio:

```{r}
# In RStudio console:
library(zzcollab)

# Initialize project
setup_project(dotfiles_path = "~/dotfiles")

# Build environment
rebuild("docker-build")

# Start RStudio Server in container (from terminal)
# make docker-rstudio
# Then open http://localhost:8787

# Check status
status()

# Add packages
add_package("tidyverse")

# Commit changes
git_status()
git_commit("Add data visualization")
git_push()
```

# Reproducibility Validation

## Check All Reproducibility Levels

```{r}
library(zzcollab)

# Comprehensive reproducibility check
if (validate_repro()) {
  message("✅ All reproducibility checks passed")
  message("✓ renv environment synchronized")
  message("✓ Validation scripts passed")
  message("✓ Package consistency verified")
} else {
  message("❌ Some reproducibility checks failed")
  message("Review output above for details")
}

# Individual validation steps (pure shell - NO R REQUIRED!)
system("make check-renv")  # Pure shell validation (grep, awk, jq)
system("Rscript check_rprofile_options.R")

# Check Docker consistency
rebuild("docker-check-renv")
```

# Integration Patterns

## Workflow Integration

### RMarkdown Integration

```{r}
# In analysis/paper/paper.Rmd header:
# ---
# title: "My Analysis"
# output: html_document
# ---

# In setup chunk:
library(zzcollab)

# Ensure environment is synchronized
sync_env()

# Validate before rendering
if (!validate_repro()) {
  warning("Reproducibility issues detected")
}

# Your analysis code follows...
```

### Package Development Integration

```{r}
# In package development workflow:
library(zzcollab)
library(devtools)

# Setup
setup_project()
rebuild("docker-build")

# Development cycle
load_all()
test()
check()

# Add dependencies
add_package("usethis")

# Validate and commit
validate_repro()
git_commit("Add new feature")
```

### CI/CD Integration

```{r}
# Check CI/CD status from R
library(zzcollab)

# After pushing commits
git_push()

# Check workflow runs (requires gh CLI)
system("gh run list --limit 5")
system("gh run view --log")

# Or open in browser
system("gh repo view --web")
```

# Troubleshooting

## Common Issues and Solutions

```{r}
# Issue: Configuration not found
if (is.null(get_config("team_name"))) {
  init_config()
  set_config("team_name", "myteam")
}

# Issue: Docker build fails
rebuild("docker-clean")
rebuild("docker-build")

# Issue: Package sync fails
if (!sync_env()) {
  message("Sync failed, checking renv status...")
  renv::status()
  renv::restore()
}

# Issue: Tests failing
rebuild("docker-test")  # Run in clean environment

# Issue: Git push rejected
git_status()
system("git pull --rebase")
git_push()
```

## Validation Helpers

```{r}
# Pre-flight checks before important operations
preflight_check <- function() {
  checks <- list(
    config_valid = validate_config(),
    repro_valid = validate_repro(),
    git_clean = length(git_status()) == 0
  )

  all_passed <- all(unlist(checks))

  if (all_passed) {
    message("✅ All pre-flight checks passed")
  } else {
    message("❌ Some checks failed:")
    print(checks)
  }

  return(all_passed)
}

# Use before major operations
if (preflight_check()) {
  git_push()
  create_pr("Add new feature", "Complete implementation with tests")
}
```

# Summary

## R Interface Functions

ZZCOLLAB provides comprehensive R interface with 25+ functions:

**Configuration**:
- `init_config()` - Initialize configuration
- `set_config(key, value)` - Set values
- `get_config(key)` - Get values
- `list_config()` - List all configuration
- `validate_config()` - Validate configuration files

**Projects**:
- `init_project(...)` - Team lead initialization
- `join_project(...)` - Team member joining
- `setup_project(...)` - Solo developer setup

**Docker**:
- `status()` - Check containers
- `rebuild(target)` - Rebuild images
- `team_images()` - List team images

**Packages**:
- `add_package(packages)` - Add packages
- `sync_env()` - Sync from renv.lock

**Analysis**:
- `run_script(path)` - Execute scripts
- `render_report(path)` - Render reports
- `validate_repro()` - Check reproducibility

**Git**:
- `git_status()` - Check status
- `git_commit(message)` - Create commits
- `git_push(branch)` - Push changes
- `create_branch(name)` - Create branches
- `create_pr(title, body)` - Create PRs

**Help**:
- `zzcollab_help(topic)` - Get help
- `zzcollab_next_steps()` - Show next steps

## Benefits of R Interface

**Seamless Integration**:
- Work entirely within R/RStudio
- No context switching to terminal
- Scriptable workflows
- Integration with RMarkdown

**Programmatic Control**:
- Automate project setup
- Batch operations across projects
- Conditional logic for workflows
- Custom helper functions

**R-Native Experience**:
- Familiar R function syntax
- RStudio autocomplete
- R help system integration
- Object-oriented workflows

## Next Steps

- See `vignette("quickstart")` for complete analysis example (shell interface)
- See `vignette("configuration")` for advanced configuration
- See `vignette("getting-started")` for detailed tutorial
- See `vignette("testing")` for testing best practices

For complete documentation of all R functions, use R's built-in help:

```{r}
?init_project
?join_project
?setup_project
?rebuild
?validate_repro
```
